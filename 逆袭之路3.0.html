<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>模拟人生：逆袭之路</title>
    <style>
        /* 金色与蓝色主题样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #fff9e6 0%, #e6f7ff 100%);
            color: #2c3e50;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.3);
            margin-top: 20px;
        }
        
        h1 {
            text-align: center;
            color: #ff9800;
            margin-bottom: 5px;
            font-size: 2.5rem;
            text-shadow: 0 0 10px rgba(255, 152, 0, 0.3);
            letter-spacing: 2px;
        }
        
        .subtitle {
            text-align: center;
            color: #2196f3;
            margin-bottom: 20px;
            font-size: 1rem;
            font-style: italic;
        }
        
        h2 {
            color: #2196f3;
            margin: 15px 0;
            border-bottom: 1px solid rgba(33, 150, 243, 0.3);
            padding-bottom: 8px;
        }
        
        .screen {
            display: none;
        }
        
        .active {
            display: block;
        }
        
        .input-group {
            margin: 20px 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #ff9800;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #2196f3;
            border-radius: 6px;
            color: #2c3e50;
            font-size: 1rem;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #ff9800;
            box-shadow: 0 0 8px rgba(255, 152, 0, 0.3);
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 24px;
            background: linear-gradient(to bottom, #2196f3, #1976d2);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
            border: 1px solid rgba(33, 150, 243, 0.3);
        }
        
        button:hover {
            background: linear-gradient(to bottom, #42a5f5, #1e88e5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        button:disabled {
            background: #d3d3d3;
            color: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background-color: rgba(227, 242, 253, 0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(33, 150, 243, 0.2);
        }
        
        .stat-value {
            font-size: 1.5rem;
            color: #2196f3;
            font-weight: bold;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 20px;
            background-color: rgba(227, 242, 253, 0.7);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(33, 150, 243, 0.2);
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #2196f3, #1976d2);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .event-box {
            background-color: rgba(227, 242, 253, 0.7);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid rgba(33, 150, 243, 0.2);
            min-height: 150px;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .option-btn {
            text-align: left;
            padding: 12px;
            background-color: rgba(187, 222, 251, 0.7);
            border: 1px solid rgba(33, 150, 243, 0.2);
        }
        
        .option-btn:hover {
            background-color: rgba(144, 202, 249, 0.7);
        }
        
        .items-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .item {
            background-color: rgba(187, 222, 251, 0.7);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid rgba(33, 150, 243, 0.2);
        }
        
        .item-name {
            font-weight: bold;
            color: #2196f3;
            margin-bottom: 5px;
        }
        
        .item-desc {
            font-size: 0.9rem;
            color: #37474f;
        }
        
        .hidden {
            display: none;
        }
        
        .ending-message {
            font-size: 1.2rem;
            line-height: 1.6;
            padding: 20px;
            background-color: rgba(227, 242, 253, 0.7);
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid rgba(33, 150, 243, 0.2);
        }
        
        .success {
            color: #004085; /* 从绿色改为深蓝色，提高对比度 */
            text-shadow: 0 0 8px rgba(0, 64, 133, 0.3);
        }
        
        .failure {
            color: #dc143c;
            text-shadow: 0 0 8px rgba(220, 20, 60, 0.3);
        }
        
        .special {
            color: #ff8c00;
            text-shadow: 0 0 8px rgba(255, 140, 0, 0.3);
        }
        
        .archive-btn {
            background: linear-gradient(to bottom, #ff9800, #f57c00);
        }
        
        .archive-btn:hover {
            background: linear-gradient(to bottom, #ffa726, #ff9800);
        }
        
        .hint {
            font-size: 0.9rem;
            color: #ff9800;
            margin-top: 5px;
        }
        
        .warning {
            color: #ff8c00;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .path-indicator {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #ff9800;
        }
        
        .restart-btn {
            background: linear-gradient(to bottom, #dc143c, #b22222);
        }

        .restart-btn:hover {
            background: linear-gradient(to bottom, #e63950, #c92b2b);
        }
        
        /* 结局图鉴样式 */
        .endings-container {
            margin: 20px 0;
        }
        
        .endings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .endings-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .endings-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1440px) {
            .endings-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 1920px) {
            .endings-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        #endings-screen .container {
            max-width: 95%;
            width: 100%;
        }

        .ending-card {
            display: flex;
            flex-direction: column;
            min-height: 200px;
            height: 100%;
        }

        .ending-title {
            font-size: 1.1rem;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .ending-desc {
            flex-grow: 1;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .ending-hint {
            font-size: 0.8rem;
            margin-top: auto;
        }
        
        .ending-card {
            background-color: rgba(227, 242, 253, 0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(33, 150, 243, 0.2);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .ending-card.unlocked {
            border-color: rgba(33, 150, 243, 0.5);
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .ending-card.locked {
            opacity: 0.6;
            background-color: rgba(227, 242, 253, 0.4);
        }
        
        .ending-title.success {
            color: #004085; /* 从绿色改为深蓝色，提高对比度 */
        }
        
        .ending-title.failure {
            color: #dc143c;
        }
        
        .ending-title.special {
            color: #ff8c00;
        }

        .ending-card.unlocked .ending-hint {
            display: none;
        }
        
        .ending-card.locked .ending-desc {
            display: none;
        }
        
        /* 体力系统样式 */
        .energy-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(227, 242, 253, 0.7);
            border-radius: 8px;
            border: 1px solid rgba(33, 150, 243, 0.2);
        }
        
        .energy-display {
            font-size: 1.2rem;
            color: #2196f3;
            font-weight: bold;
        }
        
        .energy-buttons {
            display: flex;
            gap: 10px;
        }
        
        .energy-btn {
            padding: 8px 16px;
            background: linear-gradient(to bottom, #2196f3, #1976d2);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .energy-btn:hover {
            background: linear-gradient(to bottom, #42a5f5, #1e88e5);
        }
        
        /* 体力不足警告样式 */
        .energy-warning {
            color: #dc143c;
            font-weight: bold;
            margin: 10px 0;
            text-align: center;
        }
        
        /* 手机版优化 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 14px;
            }
            
            .container {
                padding: 15px;
                margin-top: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
                margin-bottom: 15px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .stat-box {
                padding: 10px;
            }
            
            .stat-value {
                font-size: 1.2rem;
            }
            
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                min-width: 100%;
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .endings-grid {
                grid-template-columns: 1fr;
            }

            .items-container {
                grid-template-columns: 1fr;
            }
            
            .energy-container {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .event-box {
                padding: 15px;
                min-height: 120px;
            }
            
            .energy-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .energy-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
                min-width: 80px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .stat-value {
                font-size: 1rem;
            }
            
            button {
                padding: 8px 16px;
                font-size: 0.85rem;
            }
            
            .energy-btn {
                padding: 5px 10px;
                font-size: 0.75rem;
                min-width: 70px;
            }
        }
        
        .cost {
            color: #f44336;
            font-weight: bold;
        }
        
        .gain {
            color: #2e8b57;
            font-weight: bold;
        }
        
        .story-chain-indicator {
            background-color: rgba(255, 193, 7, 0.2);
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.9rem;
            border-left: 4px solid #ff9800;
        }
        
        .result-message {
            background-color: rgba(255, 248, 225, 0.7);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ff9800;
        }
        
        .negative-item {
            border-color: rgba(220, 20, 60, 0.3);
            background-color: rgba(255, 228, 225, 0.7);
        }
        
        .negative-item .item-name {
            color: #dc143c;
        }
        
        .item-consumable {
            border-color: rgba(255, 152, 0, 0.3);
            background-color: rgba(255, 243, 224, 0.7);
        }
        
        .item-consumable .item-name {
            color: #ff9800;
        }
    </style>
</head>
<body>
    <!-- 开始界面 -->
    <div id="start-screen" class="screen active">
        <h1>模拟人生：逆袭之路</h1>
        <div class="subtitle">（曙光电竞原创）</div>
        <div class="container">
            <h2>从穷小子到人生赢家</h2>
            <p>你是一个出身贫寒的年轻人，意外获得了一个神秘系统。通过这个系统，你可以在人生关键节点做出选择，利用智慧、勇气和运气改变自己的命运。</p>
            <p class="hint">（手机版可以双指缩放大小来调整到适配页面）</p>
            
            <div class="input-group">
                <label for="player-name">输入你的名字：</label>
                <input type="text" id="player-name" placeholder="输入你的姓名">
            </div>
            
            <div class="button-group">
                <button id="start-btn" disabled>开始游戏</button>
                <button id="continue-btn">继续游戏</button>
                <button id="endings-btn" class="archive-btn">结局图鉴</button>
                <button id="export-btn" class="archive-btn">导出存档</button>
                <button id="import-btn" class="archive-btn">导入存档</button>
            </div>
        </div>
    </div>
    
    <!-- 结局图鉴界面 -->
    <div id="endings-screen" class="screen">
        <h1>模拟人生：逆袭之路 - 结局图鉴</h1>
        <div class="container">
            <div class="endings-container">
                <!-- 成功结局 -->
                <h2>成功结局</h2>
                <div class="endings-grid">
                    <div class="ending-card locked">
                        <div class="ending-title success">商业帝国</div>
                        <div class="ending-desc">你建立了自己的商业帝国，成为商界传奇人物，财富自由，人生圆满。</div>
                        <div class="ending-hint">需要财富达到300万</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title success">迎娶白富美</div>
                        <div class="ending-desc">你成功追求到了心仪的白富美，两人步入婚姻殿堂，过上幸福美满的生活。</div>
                        <div class="ending-hint">需要获得白富美的青睐</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title success">科技新贵</div>
                        <div class="ending-desc">你凭借科技创新成为行业领军人物，改变了人们的生活方式，名利双收。</div>
                        <div class="ending-hint">需要掌握关键技术</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title success">投资大亨</div>
                        <div class="ending-desc">你凭借精准的投资眼光，在金融市场大获成功，成为受人尊敬的投资大亨。</div>
                        <div class="ending-hint">需要投资技能和资本</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title success">地产大鳄</div>
                        <div class="ending-desc">你在房地产市场精准布局，建立庞大的地产帝国，成为行业巨头。</div>
                        <div class="ending-hint">需要地产知识和资金</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title success">衣食无忧</div>
                        <div class="ending-desc">你积累了足够的财富，过上了衣食无忧的生活，享受人生的美好。</div>
                        <div class="ending-hint">需要财富达到100万</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title success">社会名流</div>
                        <div class="ending-desc">你通过不懈努力，获得了社会的广泛认可，成为受人尊敬的社会名流。</div>
                        <div class="ending-hint">需要社会地位达到50</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title success">行业领袖</div>
                        <div class="ending-desc">你在自己的领域取得了卓越成就，成为了行业的标杆和领袖人物。</div>
                        <div class="ending-hint">需要社会地位达到100</div>
                    </div>
                </div>
                
                <!-- 失败结局 -->
                <h2>失败结局</h2>
                <div class="endings-grid">
                    <div class="ending-card locked">
                        <div class="ending-title failure">破产清算</div>
                        <div class="ending-desc">投资失败，负债累累，最终破产清算，人生跌入谷底。</div>
                        <div class="ending-hint">资金管理不善导致</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title failure">街头流浪</div>
                        <div class="ending-desc">因一系列错误决策，失去所有，最终沦落街头，靠乞讨为生。</div>
                        <div class="ending-hint">连续做出错误选择</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title failure">健康崩溃</div>
                        <div class="ending-desc">过度劳累，忽视健康，最终身体垮掉，无法享受人生。</div>
                        <div class="ending-hint">忽视健康管理</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title failure">被骗破产</div>
                        <div class="ending-desc">轻信他人，被骗走所有财产，人生陷入绝境。</div>
                        <div class="ending-hint">缺乏判断力</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title failure">意外身亡</div>
                        <div class="ending-desc">因意外事故不幸身亡，所有梦想戛然而止。</div>
                        <div class="ending-hint">某些危险选择导致</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title failure">误入歧途</div>
                        <div class="ending-desc">因法律纠纷而误入歧途，最终银铛入狱，人生尽毁。</div>
                        <div class="ending-hint">选择了错误道路</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title failure">高利贷缠身</div>
                        <div class="ending-desc">因无法偿还高利贷，被追债人逼得走投无路，人生陷入黑暗。</div>
                        <div class="ending-hint">多次使用高利贷</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title failure">颜面尽失</div>
                        <div class="ending-desc">因被打和被嘲讽的经历，失去了尊严和自信，最终在社会中颜面尽失。</div>
                        <div class="ending-hint">持有被打或被嘲讽经历</div>
                    </div>
                </div>
                
                <!-- 特殊结局 -->
                <h2>特殊结局</h2>
                <div class="endings-grid">
                    <div class="ending-card locked">
                        <div class="ending-title special">富婆包养</div>
                        <div class="ending-desc">被富婆看中，成为她的情人，过上奢华但失去尊严的生活。</div>
                        <div class="ending-hint">需要特殊条件和魅力</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title special">系统觉醒</div>
                        <div class="ending-desc">系统突然觉醒自我意识，你成为系统的宿主，开启全新人生。</div>
                        <div class="ending-hint">需要与系统深度互动</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title special">穿越时空</div>
                        <div class="ending-desc">系统意外触发时空穿越，你回到了过去，开始全新人生。</div>
                        <div class="ending-hint">需要特定物品和条件</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title special">隐居山林</div>
                        <div class="ending-desc">看透世俗繁华，选择隐居山林，过上与世无争的简单生活。</div>
                        <div class="ending-hint">需要特定心境和经历</div>
                    </div>
                    <!-- 新增特殊结局 -->
                    <div class="ending-card locked">
                        <div class="ending-title special">G.T.I领袖</div>
                        <div class="ending-desc">你成为了G.T.I组织的领袖，掌握了巨大的权力和影响力。</div>
                        <div class="ending-hint">需要获得神秘徽章</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title special">榜一大哥</div>
                        <div class="ending-desc">你成为了女主播赛伊德的榜一大哥，获得了她的青睐，但也花费了大量财富。</div>
                        <div class="ending-hint">需要获得榜一大哥证书</div>
                    </div>
                    <div class="ending-card locked">
                        <div class="ending-title special">军事顾问</div>
                        <div class="ending-desc">你成为了老太将军的军事顾问，掌握了军事力量，成为了国家的守护者。</div>
                        <div class="ending-hint">需要获得军事顾问聘书</div>
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button id="back-from-endings-btn">返回</button>
            </div>
        </div>
    </div>
    
    <!-- 游戏主界面 -->
    <div id="game-screen" class="screen">
        <h1>模拟人生：逆袭之路</h1>
        <div class="container">
            <!-- 体力显示 -->
            <div class="energy-container">
                <div class="energy-display">体力: <span id="energy-value">0</span></div>
                <div class="energy-buttons">
                    <button class="energy-btn" id="add-energy-btn">增加体力</button>
                    <button class="energy-btn" id="reduce-energy-btn">减少体力</button>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-box">
                    <div>人物名称</div>
                    <div class="stat-value" id="display-name">-</div>
                </div>
                <div class="stat-box">
                    <div>财富值</div>
                    <div class="stat-value" id="wealth-value">100</div>
                </div>
                <div class="stat-box">
                    <div>社会地位</div>
                    <div class="stat-value" id="prestige-value">0</div>
                </div>
                <div class="stat-box">
                    <div>已完成事件</div>
                    <div class="stat-value" id="event-count">0/15</div>
                </div>
            </div>
            
            <div class="progress-container">
                <div>人生进度</div>
                <div class="progress-bar">
                    <div class="progress" id="event-progress"></div>
                </div>
            </div>
            
            <div class="event-box" id="event-description">
                欢迎来到模拟人生：逆袭之路！你是一个出身贫寒的年轻人，意外获得了一个神秘系统。通过这个系统，你可以在人生关键节点做出选择，利用智慧、勇气和运气改变自己的命运。你需要完成15个事件来积累财富和社会地位，然后面对最终的人生选择。
            </div>
            
            <div id="result-message" class="result-message hidden">
                <!-- 结果消息将在这里显示 -->
            </div>
            
            <div class="path-indicator" id="path-indicator">
                <!-- 路径指示器将通过JS动态更新 -->
            </div>
            
            <div class="button-group">
                <button id="items-btn">持有物品</button>
                <button id="system-btn">系统功能</button>
                <button id="event-btn">人生事件 0/15</button>
                <button id="view-endings-btn" class="archive-btn">查看图鉴</button>
                <button id="end-game-btn" class="restart-btn">结束游戏</button>
            </div>
            
            <div id="items-panel" class="hidden">
                <h2>持有物品</h2>
                <div class="items-container" id="items-list">
                    <!-- 物品将通过JS动态添加 -->
                </div>
                <div class="button-group">
                    <button id="close-items-btn">关闭物品面板</button>
                </div>
            </div>
            
            <div id="system-panel" class="hidden">
                <h2>系统功能</h2>
                <p>通过系统功能可以提升你的财富值，这在人生选择和最终结局中至关重要。</p>
                <p class="warning">注意：某些人生目标需要巨额财富才能达成！</p>
                <div class="button-group" id="system-options">
                    <!-- 系统选项将通过JS动态生成 -->
                </div>
                <div class="button-group">
                    <button id="close-system-btn">关闭系统面板</button>
                </div>
            </div>
            
            <div id="options-container" class="options-container hidden">
                <!-- 选项将通过JS动态添加 -->
            </div>
            
            <div id="ending-container" class="hidden">
                <!-- 结局内容将通过JS动态添加 -->
            </div>
        </div>
    </div>

    <script>
        // 游戏状态
        const gameState = {
            playerName: "",
            wealth: 100,
            prestige: 0,
            energy: 10,
            completedEvents: 0,
            items: [],
            currentEvent: null,
            eventHistory: [],
            availableEvents: [],
            completedEventIds: [],
            isEndingPhase: false,
            endingPath: [],
            currentEndingNode: null,
            systemCount: 0,
            maxSystemCount: 999,
            optionsWereVisible: false,
            eventWasActive: false,
            maxEvents: 15,
            loanDebt: 0,
            loanCount: 0,
            hasNegativeItem: false,
            activeStoryChain: null,
            rejectedChains: [],
            storyChainProgress: {} // 新增：跟踪各故事链进度
        };

        // 获取界面元素
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endingsScreen = document.getElementById('endings-screen');
        
        // 获取按钮元素
        const endingsBtn = document.getElementById('endings-btn');
        const backFromEndingsBtn = document.getElementById('back-from-endings-btn');
        const viewEndingsBtn = document.getElementById('view-endings-btn');
        const endGameBtn = document.getElementById('end-game-btn');

        // 添加事件监听器
        endingsBtn.addEventListener('click', showEndingsScreen);
        backFromEndingsBtn.addEventListener('click', hideEndingsScreen);
        viewEndingsBtn.addEventListener('click', showEndingsScreen);
        endGameBtn.addEventListener('click', function() {
            if (confirm("确定要结束当前游戏吗？当前进度将会保存，您可以稍后继续游戏。")) {
                endGame();
            }
        });

        // 体力按钮
        const addEnergyBtn = document.getElementById('add-energy-btn');
        const reduceEnergyBtn = document.getElementById('reduce-energy-btn');
        const energyValue = document.getElementById('energy-value');

        // 体力按钮事件监听
        addEnergyBtn.addEventListener('click', function() {
            const amount = prompt("请输入要增加的体力值（正数）:", "10");
            if (amount && !isNaN(amount) && amount > 0) {
                gameState.energy += parseInt(amount);
                updateDisplay();
                saveGame();
            }
        });

        reduceEnergyBtn.addEventListener('click', function() {
            const amount = prompt("请输入要减少的体力值（正数）:", "10");
            if (amount && !isNaN(amount) && amount > 0) {
                gameState.energy = Math.max(0, gameState.energy - parseInt(amount));
                updateDisplay();
                saveGame();
            }
        });

        // 结束游戏函数
        function endGame() {
            // 保存游戏状态
            saveGame();
            
            // 回到开始界面
            startScreen.classList.add('active');
            gameScreen.classList.remove('active');
            endingContainer.classList.add('hidden');
            
            // 重置事件描述为初始文本
            eventDescription.textContent = "欢迎来到模拟人生：逆袭之路！你是一个出身贫寒的年轻人，意外获得了一个神秘系统。通过这个系统，你可以在人生关键节点做出选择，利用智慧、勇气和运气改变自己的命运。你需要完成15个事件来积累财富和社会地位，然后面对最终的人生选择。";
            
            // 隐藏结果消息
            resultMessage.classList.add('hidden');
            
            // 重置事件按钮文本
            eventBtn.textContent = "人生事件 0/15";
        }

        // 物品定义
        const itemDefinitions = {
            "创业计划书": {
                description: "详细的创业计划，可以提高创业成功率",
                type: "创业",
                negative: false,
                consumable: true
            },
            "第一桶金": {
                description: "通过兼职工作赚到的第一笔资金",
                type: "资金",
                negative: false,
                consumable: true
            },
            "投资知识": {
                description: "掌握了基本的投资理财知识",
                type: "知识",
                negative: false,
                consumable: false
            },
            "贵人相助": {
                description: "得到了有影响力人士的帮助",
                type: "人脉",
                negative: false,
                consumable: true
            },
            "房产合同": {
                description: "第一套房产的购买合同",
                type: "资产",
                negative: false,
                consumable: true
            },
            "豪车钥匙": {
                description: "豪华轿车的钥匙，身份的象征",
                type: "资产",
                negative: false,
                consumable: false
            },
            "名校毕业证": {
                description: "知名大学的毕业证书",
                type: "学历",
                negative: false,
                consumable: false
            },
            "商业伙伴": {
                description: "可靠的商业合作伙伴",
                type: "人脉",
                negative: false,
                consumable: true
            },
            "健康保险": {
                description: "全面的健康保险，保障身体健康",
                type: "保障",
                negative: false,
                consumable: true
            },
            "股票账户": {
                description: "开通了股票交易账户",
                type: "投资",
                negative: false,
                consumable: false
            },
            "创业资金": {
                description: "用于创业的启动资金",
                type: "资金",
                negative: false,
                consumable: true
            },
            "商业机密": {
                description: "掌握了一些不为人知的商业信息",
                type: "信息",
                negative: false,
                consumable: true
            },
            "技术专利": {
                description: "拥有了一项有价值的技术专利",
                type: "资产",
                negative: false,
                consumable: true
            },
            "人脉网络": {
                description: "建立了广泛的人脉关系网",
                type: "人脉",
                negative: false,
                consumable: false
            },
            "品牌授权": {
                description: "获得了知名品牌的授权",
                type: "商业",
                negative: false,
                consumable: true
            },
            "投资组合": {
                description: "多样化的投资组合，分散风险",
                type: "投资",
                negative: false,
                consumable: false
            },
            "豪宅钥匙": {
                description: "豪华别墅的钥匙，生活品质的象征",
                type: "资产",
                negative: false,
                consumable: false
            },
            "私人飞机": {
                description: "私人飞机的使用权",
                type: "资产",
                negative: false,
                consumable: false
            },
            "游艇钥匙": {
                description: "豪华游艇的钥匙",
                type: "资产",
                negative: false,
                consumable: false
            },
            "慈善基金": {
                description: "设立的慈善基金，回馈社会",
                type: "社会",
                negative: false,
                consumable: true
            },
            "国际视野": {
                description: "具备国际化的视野和思维",
                type: "知识",
                negative: false,
                consumable: false
            },
            "危机处理": {
                description: "掌握危机处理的能力",
                type: "技能",
                negative: false,
                consumable: true
            },
            "谈判技巧": {
                description: "高超的谈判技巧",
                type: "技能",
                negative: false,
                consumable: true
            },
            "领导能力": {
                description: "卓越的领导能力",
                type: "技能",
                negative: false,
                consumable: false
            },
            "时间管理": {
                description: "高效的时间管理能力",
                type: "技能",
                negative: false,
                consumable: false
            },
            "健康管理": {
                description: "科学的健康管理方法",
                type: "健康",
                negative: false,
                consumable: false
            },
            "理财规划": {
                description: "全面的个人理财规划",
                type: "财务",
                negative: false,
                consumable: false
            },
            "家庭支持": {
                description: "家人的理解和支持",
                type: "情感",
                negative: false,
                consumable: true
            },
            "真爱戒指": {
                description: "与真爱的定情戒指",
                type: "情感",
                negative: false,
                consumable: false
            },
            "人生导师": {
                description: "指引人生方向的导师",
                type: "人脉",
                negative: false,
                consumable: true
            },
            "系统升级": {
                description: "系统升级后的新功能",
                type: "系统",
                negative: false,
                consumable: false  // 改为无作用物品
            },
            "幸运符": {
                description: "带来好运的神秘符咒",
                type: "特殊",
                negative: false,
                consumable: true
            },
            "重生机会": {
                description: "一次重新开始的机会",
                type: "特殊",
                negative: false,
                consumable: true
            },
            "富婆青睐": {
                description: "获得了富婆的青睐，可能改变人生轨迹",
                type: "特殊",
                negative: false,
                consumable: false
            },
            "医疗资源": {
                description: "优质的医疗资源，可以在危急时刻救命",
                type: "健康",
                negative: false,
                consumable: true
            },
            "高利贷债务": {
                description: "因资金不足而借的高利贷，利息极高",
                type: "债务",
                negative: true,
                consumable: false
            },
            "健康问题": {
                description: "因过度劳累导致的健康问题",
                type: "健康",
                negative: true,
                consumable: false
            },
            "信誉受损": {
                description: "因不当行为导致的社会信誉下降",
                type: "社会",
                negative: true,
                consumable: false
            },
            "法律纠纷": {
                description: "卷入法律纠纷，可能面临诉讼",
                type: "法律",
                negative: true,
                consumable: false
            },
            "家庭矛盾": {
                description: "因工作忙碌导致的家庭关系紧张",
                type: "情感",
                negative: true,
                consumable: false
            },
            "白富美的青睐": {
                description: "获得了白富美的青睐，可能改变人生轨迹",
                type: "情感",
                negative: false,
                consumable: false
            },
            "关键技术": {
                description: "掌握了行业关键技术，具有竞争优势",
                type: "技术",
                negative: false,
                consumable: true
            },
            "地产知识": {
                description: "掌握了房地产投资的专业知识",
                type: "知识",
                negative: false,
                consumable: false
            },
            "投资技能": {
                description: "掌握了专业的投资分析技能",
                type: "技能",
                negative: false,
                consumable: false
            },
            "系统觉醒": {
                description: "系统开始觉醒自我意识",
                type: "系统",
                negative: false,
                consumable: false
            },
            "时空装置": {
                description: "神秘的时空穿越装置",
                type: "特殊",
                negative: false,
                consumable: true
            },
            "被嘲讽经历": {
                description: "被人嘲讽的不好经历",
                type: "情感",
                negative: true,
                consumable: false
            },
            "被打经历": {
                description: "被人打的不好经历",
                type: "情感",
                negative: true,
                consumable: false
            },
            // 新增物品
            "神秘徽章": {
                description: "G.T.I组织成员的标志，拥有特殊权限",
                type: "特殊",
                negative: false,
                consumable: false
            },
            "榜一大哥证书": {
                description: "证明你是女主播赛伊德的榜一大哥",
                type: "特殊",
                negative: false,
                consumable: false
            },
            "军事顾问聘书": {
                description: "老太将军颁发的军事顾问聘书",
                type: "特殊",
                negative: false,
                consumable: false
            },
            // 新增无作用物品
            "时空研究笔记": {
                description: "关于时空研究的笔记，暂时没有实际作用",
                type: "知识",
                negative: false,
                consumable: false
            },
            "军事知识": {
                description: "基本的军事理论知识",
                type: "知识",
                negative: false,
                consumable: false
            },
            "技术知识": {
                description: "基础的科技知识",
                type: "知识",
                negative: false,
                consumable: false
            }
        };

        // 系统选项
        const systemOptions = [
            { name: "本局没带出红", value: -20000 },
            { name: "本局没撤", value: -30000 },
            { name: "一格红", value: 20000 },
            { name: "两格红", value: 40000 },
            { name: "四格红", value: 80000 },
            { name: "六格红", value: 120000 },
            { name: "九格红", value: 180000 },
            { name: "十二格红", value: 200000 },
            { name: "10万以上卡", value: 30000 },
            { name: "50万以上卡", value: 70000 },
            { name: "100万以上卡", value: 150000 },
            { name: "200万以上卡", value: 200000 },
            { name: "500万以上卡", value: 500000 },
            { name: "复苏呼吸机", value: 400000 },
            { name: "非洲之星", value: 500000 },
            { name: "海洋之泪", value: 800000 }
        ];

        // 故事链定义
        const storyChains = {
            // 彩票故事链
            lottery: {
                name: "彩票奇遇",
                events: [1, 2, 3, 4, 5],
                rejectionEvent: 1
            },
            // 创业故事链
            startup: {
                name: "创业之路",
                events: [6, 7, 8, 9, 10],
                rejectionEvent: 6
            },
            // 投资故事链
            investment: {
                name: "投资理财",
                events: [11, 12, 13, 14, 15],
                rejectionEvent: 11
            },
            // 房地产故事链
            realEstate: {
                name: "房地产投资",
                events: [16, 17, 18, 19, 20],
                rejectionEvent: 16
            },
            // 人际关系故事链
            relationship: {
                name: "人际关系",
                events: [21, 22, 23, 24, 25],
                rejectionEvent: 21
            },
            // 健康故事链
            health: {
                name: "健康管理",
                events: [26, 27, 28, 29, 30],
                rejectionEvent: 26
            },
            // 富婆故事链
            richWoman: {
                name: "富婆包养",
                events: [31, 32, 33, 34, 35],
                rejectionEvent: 31
            },
            // 科技故事链
            technology: {
                name: "科技创新",
                events: [36, 37, 38, 39, 40],
                rejectionEvent: 36
            },
            // 桃花运故事链（原名白富美故事链）
            peachBlossom: {
                name: "桃花运",
                events: [41, 42, 43, 44, 45],
                rejectionEvent: 41
            },
            // 系统觉醒故事链
            systemAwakening: {
                name: "系统觉醒",
                events: [46, 47, 48, 49, 50],
                rejectionEvent: 46
            },
            // 时空穿越故事链
            timeTravel: {
                name: "时空穿越",
                events: [51, 52, 53, 54, 55],
                rejectionEvent: 51
            },
            // 暴富机会故事链（原名被骗破产）
            deceived: {
                name: "暴富机会",
                events: [56, 57, 58, 59, 60],
                rejectionEvent: 56
            },
            // 街头流浪故事链
            homeless: {
                name: "街头流浪",
                events: [61, 62, 63, 64, 65],
                rejectionEvent: 61
            },
            // 被人嘲讽故事链
            mocked: {
                name: "被人嘲讽",
                events: [66, 67, 68, 69, 70],
                rejectionEvent: 66
            },
            // 被人打故事链
            beaten: {
                name: "被人殴打",
                events: [71, 72, 73, 74, 75],
                rejectionEvent: 71
            },
            // 修改后的故事链 - G.T.I组织
            secretOrganization: {
                name: "G.T.I组织",
                events: [76, 77, 78, 79, 80],
                rejectionEvent: 76
            },
            // 新增故事链 - 女主播赛伊德
            liveStreaming: {
                name: "女主播赛伊德",
                events: [81, 82, 83, 84, 85],
                rejectionEvent: 81
            },
            // 新增故事链 - 军事顾问
            military: {
                name: "军事顾问",
                events: [86, 87, 88, 89, 90],
                rejectionEvent: 86
            }
        };

        // 事件池 - 重新设计的连贯事件
        const allEvents = [
            // 彩票故事链
            {
                id: 1,
                description: "你路过彩票店，看到门口贴着'头奖500万'的广告。你摸了摸口袋里的零钱，犹豫要不要试试运气。",
                options: [
                    { text: "花2元买一张彩票", cost: 2, result: "你买了一张彩票，期待能有好运降临。", chainAccept: "lottery" },
                    { text: "不买，觉得是浪费钱", result: "你觉得买彩票是浪费钱，决定把钱用在更有意义的地方。", chainReject: "lottery" }
                ],
                chain: "lottery"
            },
            {
                id: 2,
                description: "你买的彩票开奖了，居然中了1000元！这是你人生中第一次中这么大的奖。",
                options: [
                    { text: "全部存起来", effect: { wealth: 1000 }, result: "你把中奖的钱全部存了起来，这是你人生中的第一笔积蓄。" },
                    { text: "拿出500元继续买彩票", cost: 500, effect: { item: "多张彩票" }, result: "你拿出500元继续买彩票，希望能中更大的奖。" },
                    { text: "请朋友威风的龙吃饭庆祝", cost: 300, effect: { prestige: 4 }, result: "你请朋友威风的龙吃饭庆祝，大家都为你感到高兴，你的人缘变得更好了。" }
                ],
                chain: "lottery",
                requires: [1]
            },
            {
                id: 3,
                description: "你用中奖的钱继续买彩票，这次居然中了50000元！你开始相信运气真的存在。",
                options: [
                    { text: "全部存起来", effect: { wealth: 50000 }, result: "你把中奖的钱全部存了起来，现在你有了一笔可观的积蓄。" },
                    { text: "投资学习理财知识", cost: 1000, effect: { item: "投资知识" }, result: "你投资学习理财知识，希望让钱生钱。" },
                    { text: "辞职专门研究彩票", effect: { prestige: -4 }, result: "你决定辞职专门研究彩票，希望能中更大的奖。" }
                ],
                chain: "lottery",
                requires: [2]
            },
            {
                id: 4,
                description: "你沉迷于彩票研究，但连续几个月都没有中大奖。你的积蓄在慢慢减少。",
                options: [
                    { text: "继续坚持，相信会中大奖", cost: 5000, result: "你继续坚持买彩票，但运气似乎不再眷顾你。" },
                    { text: "减少投入，寻找其他机会", result: "你减少了彩票投入，开始寻找其他赚钱的机会。" },
                    { text: "彻底放弃彩票，回归正轨", effect: { prestige: 2 }, result: "你彻底放弃彩票，决定回归正常的工作和生活。" }
                ],
                chain: "lottery",
                requires: [3]
            },
            {
                id: 5,
                description: "在最后一次尝试中，你中了100000元！这让你重新燃起希望，但也让你意识到不能全靠运气。",
                options: [
                    { text: "用这笔钱开始创业", effect: { wealth: 100000, item: "创业资金" }, result: "你用这笔钱开始创业，希望能创造属于自己的事业。" },
                    { text: "投资房产", effect: { wealth: 100000, item: "房产合同" }, result: "你用这笔钱投资房产，希望能通过房地产增值。" },
                    { text: "继续买彩票，追求更大奖项", cost: 50000, result: "你继续买彩票，希望能中更大的奖。" }
                ],
                chain: "lottery",
                requires: [4]
            },
            
            // 创业故事链
            {
                id: 6,
                description: "你决定用积蓄开一家小餐馆。你需要选择餐馆的类型和定位。",
                options: [
                    { text: "开快餐店，投资小回报快 (花费: 50000元)", cost: 50000, effect: { item: "创业计划书" }, result: "你开了一家快餐店，虽然投资不大，但生意还不错。", chainAccept: "startup" },
                    { text: "开特色餐厅，投资大但利润高 (花费: 100000元)", cost: 100000, effect: { item: "创业计划书" }, result: "你开了一家特色餐厅，虽然投资较大，但客单价高，利润可观。", chainAccept: "startup" },
                    { text: "开小吃摊，风险小但辛苦 (花费: 10000元)", cost: 10000, effect: { item: "创业计划书" }, result: "你开了一个小吃摊，虽然辛苦，但风险小，收入稳定。", chainAccept: "startup" },
                    { text: "放弃创业想法", result: "你觉得创业风险太大，决定放弃创业想法。", chainReject: "startup" }
                ],
                chain: "startup"
            },
            {
                id: 7,
                description: "你的餐馆开业了，但生意不如预期。你需要想办法吸引顾客。",
                options: [
                    { text: "打折促销，吸引人气 (花费: 5000元)", cost: 5000, effect: { prestige: 4 }, result: "你进行了打折促销，吸引了不少顾客，生意开始好转。" },
                    { text: "改进菜品质量，靠口碑传播 (花费: 10000元)", cost: 10000, effect: { prestige: 6 }, result: "你改进了菜品质量，顾客的口碑传播让你的生意越来越好。" },
                    { text: "花钱做广告宣传 (花费: 20000元)", cost: 20000, effect: { prestige: 10 }, result: "你花钱做了广告宣传，知名度提高，生意明显好转。" }
                ],
                chain: "startup",
                requires: [6]
            },
            {
                id: 8,
                description: "你的促销活动见效了，餐馆开始有了稳定的客流。但你也遇到了新的问题。",
                options: [
                    { text: "扩大店面，增加座位 (花费: 50000元)", cost: 50000, effect: { wealth: 10000 }, result: "你扩大了店面，增加了座位，营业额明显提升。" },
                    { text: "开分店，扩大经营 (花费: 100000元)", cost: 100000, effect: { wealth: 20000 }, result: "你开了分店，扩大了经营规模，收入大幅增加。" },
                    { text: "保持现状，稳扎稳打", effect: { wealth: 5000 }, result: "你决定保持现状，稳扎稳打，生意稳定发展。" }
                ],
                chain: "startup",
                requires: [7]
            },
            {
                id: 9,
                description: "你的餐馆生意越来越好，有人想投资你的品牌，帮助你快速扩张。",
                options: [
                    { text: "接受投资，快速扩张", effect: { wealth: 200000, item: "商业伙伴" }, result: "你接受了投资，开始快速扩张，品牌知名度大幅提升。" },
                    { text: "拒绝投资，保持独立", effect: { wealth: 50000 }, result: "你拒绝了投资，决定保持独立经营。" },
                    { text: "部分接受，保留控制权", effect: { wealth: 100000, item: "商业伙伴" }, result: "你部分接受了投资，既获得了资金支持，又保留了控制权。" }
                ],
                chain: "startup",
                requires: [8]
            },
            {
                id: 10,
                description: "随着生意扩大，你遇到了管理难题。员工效率低下，成本控制不当。",
                options: [
                    { text: "聘请专业经理人管理 (花费: 50000元)", cost: 50000, effect: { item: "管理团队" }, result: "你聘请了专业经理人，管理问题得到了有效解决。" },
                    { text: "自己学习管理知识 (花费: 10000元)", cost: 10000, effect: { item: "管理知识" }, result: "你自己学习了管理知识，管理能力得到提升。" },
                    { text: "裁员精简，亲自管理", effect: { prestige: -4, item: "家庭矛盾" }, result: "你进行了裁员精简，亲自管理，虽然节省了成本，但员工士气低落，家庭关系也受到影响。" }
                ],
                chain: "startup",
                requires: [9]
            },
            
            // 投资故事链
            {
                id: 11,
                description: "你决定学习投资理财知识，希望能让钱生钱。",
                options: [
                    { text: "购买股票", cost: 10000, effect: { item: "股票账户" }, result: "你购买了股票，开始了投资之路。", chainAccept: "investment" },
                    { text: "投资基金", cost: 5000, effect: { item: "投资知识" }, result: "你投资了基金，风险相对较小。", chainAccept: "investment" },
                    { text: "投资数字货币", cost: 2000, result: "你投资了数字货币，风险较高但可能回报也高。", chainAccept: "investment" },
                    { text: "放弃投资想法", result: "你觉得投资风险太大，决定放弃投资想法。", chainReject: "investment" }
                ],
                chain: "investment"
            },
            {
                id: 12,
                description: "你的投资获得了不错的回报，你开始考虑加大投资力度。",
                options: [
                    { text: "加大股票投资", cost: 50000, effect: { wealth: 100000 }, result: "你加大了股票投资，获得了丰厚的回报。" },
                    { text: "多元化投资", cost: 30000, effect: { item: "投资组合" }, result: "你进行了多元化投资，分散了风险。" },
                    { text: "投资房地产", cost: 80000, effect: { item: "地产知识" }, result: "你投资了房地产，开始了解这个行业。" }
                ],
                chain: "investment",
                requires: [11]
            },
            {
                id: 13,
                description: "市场出现了波动，你的投资组合价值下跌。",
                options: [
                    { text: "坚持持有，相信会反弹", effect: { wealth: -20000 }, result: "你坚持持有，但市场继续下跌，损失了一些财富。" },
                    { text: "止损卖出，减少损失", effect: { wealth: -10000 }, result: "你止损卖出，虽然损失了一些，但避免了更大的损失。" },
                    { text: "加仓买入，降低成本", cost: 50000, effect: { wealth: 80000 }, result: "你加仓买入，降低了平均成本，市场反弹后获得了更大收益。" }
                ],
                chain: "investment",
                requires: [12]
            },
            {
                id: 14,
                description: "你遇到了投资专家红狼，他向你推荐一个高回报项目。",
                options: [
                    { text: "谨慎投资少量资金", cost: 10000, effect: { wealth: 30000 }, result: "你谨慎投资了少量资金，获得了不错的回报。" },
                    { text: "大量投资", cost: 100000, effect: { wealth: 250000 }, result: "你大量投资，获得了巨额回报。" },
                    { text: "拒绝投资，保持谨慎", result: "你觉得风险太大，拒绝了投资。" }
                ],
                chain: "investment",
                requires: [13]
            },
            {
                id: 15,
                description: "你的投资技能越来越成熟，开始考虑成立自己的投资公司。",
                options: [
                    { text: "成立投资公司", cost: 200000, effect: { item: "投资技能" }, result: "你成立了投资公司，开始了专业投资生涯。" },
                    { text: "成为独立投资人", effect: { wealth: 150000 }, result: "你选择成为独立投资人，自由灵活。" },
                    { text: "加入大型投资机构", effect: { prestige: 20 }, result: "你加入了大型投资机构，获得了稳定的收入和更高的社会地位。" }
                ],
                chain: "investment",
                requires: [14]
            },
            
            // 桃花运故事链（原名白富美故事链）
            {
                id: 41,
                description: "在一次社交活动中，你遇到了一位美丽优雅的女士麦小鼠。她对你表现出了兴趣。",
                options: [
                    { text: "主动接近，尝试交往", effect: { prestige: 4 }, result: "你主动接近麦小鼠，两人开始交往。", chainAccept: "peachBlossom" },
                    { text: "保持距离，专注事业", result: "你觉得现在应该专注事业，放弃了交往的机会。", chainReject: "peachBlossom" }
                ],
                chain: "peachBlossom"
            },
            {
                id: 42,
                description: "你和麦小鼠的关系越来越亲密，你发现她很有品味和见识。",
                options: [
                    { text: "努力提升自己，配得上她", effect: { prestige: 10 }, result: "你努力提升自己，希望配得上她。" },
                    { text: "坦诚相待，展示真实自我", effect: { prestige: 6 }, result: "你选择坦诚相待，展示真实的自己。" },
                    { text: "退缩放弃，觉得差距太大", effect: { prestige: -4 }, result: "你觉得差距太大，选择了退缩。" }
                ],
                chain: "peachBlossom",
                requires: [41]
            },
            {
                id: 43,
                description: "你发现麦小鼠其实是位白富美，她的家人知道了你们的关系，他们对你的背景不太满意。",
                options: [
                    { text: "努力证明自己的价值", effect: { prestige: 16 }, result: "你努力证明自己的价值，赢得了她家人的尊重。" },
                    { text: "寻求麦小鼠的支持", effect: { item: "白富美的青睐" }, result: "你寻求麦小鼠的支持，她坚定地站在你这边。" },
                    { text: "放弃这段感情", effect: { prestige: -10 }, result: "你觉得压力太大，放弃了这段感情。" }
                ],
                chain: "peachBlossom",
                requires: [42]
            },
            {
                id: 44,
                description: "你通过了麦小鼠家人的考验，他们开始接受你。",
                options: [
                    { text: "求婚", effect: { wealth: 50000, prestige: 10 }, result: "你向麦小鼠求婚，她答应了。你们决定共同规划未来。" }, // 修改：不再获得真爱戒指
                    { text: "继续交往，加深了解", effect: { prestige: 20 }, result: "你选择继续交往，加深彼此的了解。" },
                    { text: "专注于事业，暂时不谈婚论嫁", effect: { wealth: 100000 }, result: "你专注于事业，暂时不谈婚论嫁。" }
                ],
                chain: "peachBlossom",
                requires: [43]
            },
            {
                id: 45,
                description: "你和麦小鼠的关系稳定发展，开始考虑未来。",
                options: [
                    { text: "结婚，开始家庭生活 (花费: 100000元)", cost: 100000, effect: { prestige: 40, item: "真爱戒指" }, result: "你和麦小鼠结婚，开始了幸福的家庭生活。" }, // 修改：添加花费条件
                    { text: "共同创业，打造未来", effect: { wealth: 500000, item: "商业伙伴" }, result: "你和麦小鼠共同创业，打造美好的未来。" },
                    { text: "各自发展，保持独立", effect: { prestige: 30 }, result: "你们选择各自发展，保持独立的关系。" }
                ],
                chain: "peachBlossom",
                requires: [44]
            },
            
            // 富婆故事链
            {
                id: 31,
                description: "你在一次商务活动中认识了一位富有的中年女性佐娅，她对你表现出了特别的兴趣。",
                options: [
                    { text: "接受她的邀请共进晚餐", effect: { prestige: -2 }, result: "你接受了她的邀请，两人共进晚餐。", chainAccept: "richWoman" }, // 修改：接受邀请扣社会地位
                    { text: "礼貌拒绝，保持距离", result: "你觉得这种关系不合适，礼貌地拒绝了。", chainReject: "richWoman" }
                ],
                chain: "richWoman"
            },
            {
                id: 32,
                description: "富婆佐娅对你越来越感兴趣，提出要资助你的事业。",
                options: [
                    { text: "接受资助，但保持独立", effect: { wealth: 50000, prestige: -4 }, result: "你接受了她的资助，但保持了独立性。" }, // 修改：接受资助扣社会地位
                    { text: "完全接受她的条件", effect: { wealth: 100000, prestige: -8 }, result: "你完全接受了她的条件，获得了大量资金支持。" }, // 修改：接受条件扣社会地位
                    { text: "婉拒资助，靠自己努力", effect: { prestige: 4 }, result: "你婉拒了她的资助，决定靠自己的能力。" }
                ],
                chain: "richWoman",
                requires: [31]
            },
            {
                id: 33,
                description: "富婆佐娅提出要和你建立更亲密的关系，并承诺给你更多支持。",
                options: [
                    { text: "接受关系，获得更多资源", effect: { wealth: 200000, prestige: -12 }, result: "你接受了这种关系，获得了更多资源。" }, // 修改：接受关系扣社会地位
                    { text: "保持朋友关系", effect: { wealth: 50000, prestige: -4 }, result: "你选择保持朋友关系。" }, // 修改：保持关系也扣社会地位
                    { text: "彻底断绝关系", effect: { prestige: 6 }, result: "你彻底断绝了与她的关系。" }
                ],
                chain: "richWoman",
                requires: [32]
            },
            {
                id: 34,
                description: "你和富婆佐娅的关系被外界知道了，引起了各种议论。",
                options: [
                    { text: "不在乎他人看法", effect: { wealth: 100000, prestige: -10 }, result: "你不在乎他人的看法，继续这种关系。" }, // 修改：继续关系扣社会地位
                    { text: "减少公开露面", effect: { prestige: -10 }, result: "你减少了公开露面，避免引起更多议论。" },
                    { text: "结束关系，重新开始", effect: { prestige: 6 }, result: "你结束了这种关系，决定重新开始。" }
                ],
                chain: "richWoman",
                requires: [33]
            },
            {
                id: 35,
                description: "富婆佐娅提出要和你结婚，但要求你放弃自己的事业。",
                options: [
                    { text: "接受求婚，放弃事业", effect: { wealth: 500000, item: "富婆青睐" }, result: "你接受了求婚，放弃了事业，过上了奢华的生活。" }, // 修改：只有这里能获得富婆青睐
                    { text: "拒绝求婚，保持独立", effect: { prestige: 10 }, result: "你拒绝了求婚，决定保持独立。" },
                    { text: "协商折中方案", effect: { wealth: 200000, prestige: 6 }, result: "你与她协商了一个折中方案。" }
                ],
                chain: "richWoman",
                requires: [34]
            },
            
            // 科技故事链
            {
                id: 36,
                description: "你对科技产生了浓厚兴趣，决定学习编程和人工智能技术。",
                options: [
                    { text: "报名参加编程培训班 (花费: 10000元)", cost: 10000, effect: { item: "技术知识" }, result: "你报名参加了编程培训班，开始学习编程。", chainAccept: "technology" }, // 修改：获得技术知识而非关键技术
                    { text: "自学编程，节省开支", effect: { item: "技术知识" }, result: "你选择自学编程，节省了开支。", chainAccept: "technology" }, // 修改：获得技术知识而非关键技术
                    { text: "放弃科技方向", result: "你觉得科技领域太难，放弃了学习。", chainReject: "technology" }
                ],
                chain: "technology"
            },
            {
                id: 37,
                description: "你掌握了一定的编程技能，开始尝试开发自己的应用程序。",
                options: [
                    { text: "开发实用工具类应用", effect: { wealth: 50000 }, result: "你开发了一款实用工具应用，获得了不错的下载量。" },
                    { text: "开发社交娱乐应用", effect: { prestige: 6 }, result: "你开发了一款社交娱乐应用，获得了一定的用户。" },
                    { text: "开发人工智能应用", effect: { item: "技术知识" }, result: "你专注于开发人工智能应用，掌握了更多技术知识。" } // 修改：获得技术知识而非关键技术
                ],
                chain: "technology",
                requires: [36]
            },
            {
                id: 38,
                description: "你的应用获得了一些关注，有投资者对你的项目感兴趣。",
                options: [
                    { text: "接受投资，扩大团队", effect: { wealth: 200000 }, result: "你接受了投资，扩大了团队规模。" },
                    { text: "保持独立，缓慢发展", effect: { wealth: 50000 }, result: "你选择保持独立，缓慢发展。" },
                    { text: "寻找技术合伙人", effect: { item: "技术专利" }, result: "你找到了技术合伙人，共同开发项目。" }
                ],
                chain: "technology",
                requires: [37]
            },
            {
                id: 39,
                description: "你的应用用户量持续增长，面临扩大服务器和优化性能的挑战。",
                options: [
                    { text: "投入大量资金升级服务器 (花费: 100000元)", cost: 100000, effect: { wealth: 300000 }, result: "你投入资金升级了服务器，用户体验大幅提升。" },
                    { text: "优化代码，提高效率", effect: { item: "技术知识" }, result: "你通过优化代码提高了应用性能。" }, // 修改：获得技术知识而非关键技术
                    { text: "寻求云服务合作", effect: { wealth: 150000 }, result: "你与云服务商合作，降低了成本。" }
                ],
                chain: "technology",
                requires: [38]
            },
            {
                id: 40,
                description: "你的应用获得了巨大成功，成为了行业标杆。",
                options: [
                    { text: "公司上市，成为科技新贵", effect: { wealth: 1000000, item: "关键技术" }, result: "你的公司成功上市，你成为了科技新贵。" }, // 修改：只有这里能获得关键技术
                    { text: "被大公司收购", effect: { wealth: 500000 }, result: "你选择被大公司收购，获得了巨额资金。" },
                    { text: "继续独立发展", effect: { wealth: 300000, prestige: 40 }, result: "你选择继续独立发展，保持了公司的控制权。" }
                ],
                chain: "technology",
                requires: [39]
            },
            
            // 系统觉醒故事链
            {
                id: 46,
                description: "你发现系统开始出现一些异常行为，似乎有了自己的意识。",
                options: [
                    { text: "深入研究系统异常", effect: { item: "系统升级" }, result: "你深入研究了系统异常，发现了系统的秘密。", chainAccept: "systemAwakening" },
                    { text: "忽略异常，继续使用", result: "你忽略了系统的异常，继续正常使用。", chainReject: "systemAwakening" }
                ],
                chain: "systemAwakening"
            },
            {
                id: 47,
                description: "系统开始与你进行简单的对话，表现出了一定的智能。",
                options: [
                    { text: "与系统建立更深连接", effect: { prestige: 4 }, result: "你与系统建立了更深层次的连接。" },
                    { text: "保持距离，谨慎使用", result: "你选择与系统保持距离，谨慎使用。" },
                    { text: "尝试关闭系统", effect: { wealth: -50000 }, result: "你尝试关闭系统，但系统反抗，造成了一些损失。" }
                ],
                chain: "systemAwakening",
                requires: [46]
            },
            {
                id: 48,
                description: "系统告诉你它来自未来，是为了帮助你改变命运而被创造的。",
                options: [
                    { text: "相信系统，接受帮助", effect: { wealth: 100000 }, result: "你相信了系统，接受了它的帮助。" },
                    { text: "怀疑系统，保持警惕", effect: { prestige: 6 }, result: "你对系统保持警惕，没有完全相信它。" },
                    { text: "尝试理解系统的本质", effect: { prestige: 10 }, result: "你尝试理解系统的本质和目的。" }
                ],
                chain: "systemAwakening",
                requires: [47]
            },
            {
                id: 49,
                description: "系统提出要与你融合，成为你的一部分。",
                options: [
                    { text: "接受融合", effect: { item: "系统升级" }, result: "你接受了与系统的融合。" }, // 修改：获得系统升级而非系统觉醒
                    { text: "拒绝融合，保持独立", effect: { wealth: 50000 }, result: "你拒绝了融合，保持了独立性。" },
                    { text: "协商共同存在方式", effect: { prestige: 10 }, result: "你与系统协商了一种共同存在的方式。" }
                ],
                chain: "systemAwakening",
                requires: [48]
            },
            {
                id: 50,
                description: "系统完全觉醒，你成为了系统的宿主，获得了前所未有的能力。",
                options: [
                    { text: "利用系统能力改变世界", effect: { wealth: 500000, item: "系统觉醒" }, result: "你利用系统的能力开始改变世界。" }, // 修改：只有这里能获得系统觉醒
                    { text: "保持低调，谨慎使用能力", effect: { wealth: 200000, prestige: 20 }, result: "你保持低调，谨慎使用系统的能力。" },
                    { text: "研究系统来源和目的", effect: { item: "时空研究笔记" }, result: "你专注于研究系统的来源和真正目的。" } // 修改：获得时空研究笔记而非时空装置
                ],
                chain: "systemAwakening",
                requires: [49]
            },
            
            // 时空穿越故事链
            {
                id: 51,
                description: "你在使用系统时意外触发了时空波动，看到了过去的自己。",
                options: [
                    { text: "深入研究时空波动", effect: { item: "时空研究笔记" }, result: "你深入研究了时空波动，发现了穿越的可能性。", chainAccept: "timeTravel" }, // 修改：获得时空研究笔记而非时空装置
                    { text: "忽略波动，继续正常生活", result: "你忽略了时空波动，继续正常生活。", chainReject: "timeTravel" }
                ],
                chain: "timeTravel"
            },
            {
                id: 52,
                description: "你成功制造了一个简单的时空装置，可以短暂回到过去。",
                options: [
                    { text: "回到过去改变关键决策", effect: { wealth: 100000 }, result: "你回到过去改变了一个关键决策，获得了巨大收益。" },
                    { text: "观察过去，不干预", effect: { prestige: 10 }, result: "你选择只观察过去，不进行干预。" },
                    { text: "尝试前往未来", effect: { item: "时空研究笔记" }, result: "你尝试前往未来，但遇到了技术难题。" } // 修改：获得时空研究笔记而非时空装置
                ],
                chain: "timeTravel",
                requires: [51]
            },
            {
                id: 53,
                description: "你的时空实验引起了时间管理局的注意，他们警告你不要扰乱时间线。",
                options: [
                    { text: "停止实验，遵守规则", effect: { prestige: 6 }, result: "你停止了时空实验，遵守了时间管理局的规则。" },
                    { text: "继续秘密实验", effect: { wealth: 150000 }, result: "你选择继续秘密进行时空实验。" },
                    { text: "与时间管理局合作", effect: { item: "时空研究笔记" }, result: "你选择与时间管理局合作，共同研究时空技术。" } // 修改：获得时空研究笔记而非时空装置
                ],
                chain: "timeTravel",
                requires: [52]
            },
            {
                id: 54,
                description: "你发现了一个重大的时空悖论，可能会影响整个时间线。",
                options: [
                    { text: "尝试解决悖论", effect: { prestige: 20 }, result: "你尝试解决时空悖论，避免了灾难。" },
                    { text: "无视悖论，继续实验", effect: { wealth: -100000 }, result: "你无视了悖论，继续实验，导致了严重后果。" },
                    { text: "寻求时间管理局帮助", effect: { item: "时空研究笔记" }, result: "你寻求时间管理局的帮助，共同解决了悖论。" } // 修改：获得时空研究笔记而非时空装置
                ],
                chain: "timeTravel",
                requires: [53]
            },
            {
                id: 55,
                description: "你掌握了成熟的时空技术，可以自由穿梭于不同时间点。",
                options: [
                    { text: "回到过去重新开始人生", effect: { item: "时空装置" }, result: "你回到了过去，开始了全新的人生。" }, // 修改：只有这里能获得时空装置
                    { text: "前往未来探索未知", effect: { wealth: 300000 }, result: "你前往未来，带回了先进的技术。" },
                    { text: "成为时间守护者", effect: { prestige: 40 }, result: "你成为了时间守护者，保护时间线的稳定。" }
                ],
                chain: "timeTravel",
                requires: [54]
            },
            
            // 暴富机会故事链（原名被骗破产）
            {
                id: 56,
                description: "你在网上认识了一个自称是投资专家红狼的人，他向你推荐一个高回报项目。",
                options: [
                    { text: "谨慎调查后再决定", result: "你谨慎地调查了这个项目，发现是骗局。", chainReject: "deceived" },
                    { text: "相信专家，投入资金 (花费: 50000元)", cost: 50000, result: "你相信了专家，投入了资金。", chainAccept: "deceived" }
                ],
                chain: "deceived"
            },
            {
                id: 57,
                description: "你的投资获得了不错的回报，专家红狼建议你加大投资。",
                options: [
                    { text: "加大投资 (花费: 100000元)", cost: 100000, result: "你加大了投资，期待更高回报。" },
                    { text: "收回本金和利润", effect: { wealth: 60000 }, result: "你收回了本金和利润，避免了损失。" },
                    { text: "继续观望", result: "你选择继续观望，没有立即行动。" }
                ],
                chain: "deceived",
                requires: [56]
            },
            {
                id: 58,
                description: "专家红狼告诉你有一个千载难逢的机会，需要大量资金投入。",
                options: [
                    { text: "投入所有积蓄 (花费: 200000元)", cost: 200000, result: "你投入了所有积蓄，期待巨大回报。" },
                    { text: "只投入部分资金 (花费: 50000元)", cost: 50000, result: "你只投入了部分资金，保留了大部分积蓄。" },
                    { text: "拒绝投资，觉得风险太大", effect: { prestige: 4 }, result: "你拒绝了投资，觉得风险太大。" }
                ],
                chain: "deceived",
                requires: [57]
            },
            {
                id: 59,
                description: "你发现无法联系到专家红狼，投资平台也无法访问。",
                options: [
                    { text: "报警寻求帮助", effect: { item: "法律纠纷" }, result: "你报警寻求帮助，但追回资金的可能性很小。" },
                    { text: "自己调查追踪", effect: { wealth: -50000 }, result: "你自己调查追踪，但花费了大量资金却无结果。" },
                    { text: "接受现实，重新开始", effect: { prestige: -10 }, result: "你接受了被骗的现实，决定重新开始。" }
                ],
                chain: "deceived",
                requires: [58]
            },
            {
                id: 60,
                description: "你因为投资被骗损失了大量资金，面临财务危机。",
                options: [
                    { text: "向亲友借钱度过难关", effect: { wealth: 50000, item: "家庭矛盾" }, result: "你向亲友借钱，暂时度过了难关。" },
                    { text: "申请破产保护", effect: { item: "法律纠纷" }, result: "你申请了破产保护，开始重建财务。" },
                    { text: "努力工作偿还债务", effect: { prestige: -20 }, result: "你努力工作，慢慢偿还债务。" }
                ],
                chain: "deceived",
                requires: [59]
            },
            
            // 被人嘲讽故事链
            {
                id: 66,
                description: "你在一次社交场合因为穿着普通被人鸟兽兽嘲讽。",
                options: [
                    { text: "无视嘲讽，保持自信", effect: { prestige: 2 }, result: "你无视了嘲讽，保持了自信。", chainReject: "mocked" },
                    { text: "感到羞辱，决心改变", effect: { item: "被嘲讽经历" }, result: "你感到羞辱，决心改变现状。", chainAccept: "mocked" }
                ],
                chain: "mocked"
            },
            {
                id: 67,
                description: "你开始努力提升自己的形象和社会地位。",
                options: [
                    { text: "学习社交礼仪和着装", effect: { prestige: 6 }, result: "你学习了社交礼仪和着装，形象大幅提升。" },
                    { text: "专注于事业发展", effect: { wealth: 50000 }, result: "你专注于事业发展，取得了不错的成绩。" },
                    { text: "报复那些嘲讽你的人", effect: { prestige: -4 }, result: "你试图报复那些嘲讽你的人，但效果不佳。" }
                ],
                chain: "mocked",
                requires: [66]
            },
            {
                id: 68,
                description: "你在一次重要场合再次遇到了曾经嘲讽你的鸟兽兽。",
                options: [
                    { text: "优雅地展示自己的成就", effect: { prestige: 10 }, result: "你优雅地展示了自己的成就，赢得了尊重。" },
                    { text: "直接 confrontation", effect: { prestige: -6 }, result: "你直接与对方对峙，但引起了不必要的冲突。" },
                    { text: "无视对方，专注于自己的事", effect: { prestige: 4 }, result: "你无视了对方，专注于自己的事情。" }
                ],
                chain: "mocked",
                requires: [67]
            },
            {
                id: 69,
                description: "那些曾经嘲讽你的鸟兽兽开始对你刮目相看。",
                options: [
                    { text: "大方接受他们的认可", effect: { prestige: 6 }, result: "你大方接受了他们的认可，展现了风度。" },
                    { text: "保持距离，不深交", effect: { prestige: 2 }, result: "你与他们保持距离，没有深交。" },
                    { text: "趁机建立人脉", effect: { item: "人脉网络" }, result: "你趁机建立了有价值的人脉网络。" }
                ],
                chain: "mocked",
                requires: [68]
            },
            {
                id: 70,
                description: "你成为了社交圈中的成功人士，再也没有人敢嘲讽你。",
                options: [
                    { text: "帮助其他被嘲讽的人", effect: { prestige: 10 }, result: "你帮助其他被嘲讽的人，成为了他们的榜样。" },
                    { text: "专注于自己的事业", effect: { wealth: 100000 }, result: "你专注于自己的事业，取得了更大成功。" },
                    { text: "享受成功的喜悦", effect: { prestige: 6 }, result: "你享受着成功的喜悦，过上了满意的生活。" }
                ],
                chain: "mocked",
                requires: [69]
            },
            
            // 被人打故事链
            {
                id: 71,
                description: "你在一次冲突中被小灰酱殴打，受了轻伤。",
                options: [
                    { text: "报警处理", effect: { item: "法律纠纷" }, result: "你报警处理了此事，对方受到了惩罚。", chainReject: "beaten" },
                    { text: "忍气吞声，避免 further 冲突", effect: { item: "被打经历" }, result: "你选择了忍气吞声，避免了 further 冲突。", chainAccept: "beaten" }
                ],
                chain: "beaten"
            },
            {
                id: 72,
                description: "你因为被打的经历变得谨慎和内向。",
                options: [
                    { text: "学习自卫技能", effect: { prestige: 4 }, result: "你学习了自卫技能，增强了自信心。" },
                    { text: "避免去可能发生冲突的场所", effect: { prestige: -2 }, result: "你避免去可能发生冲突的场所，生活圈子变小了。" },
                    { text: "寻求心理咨询", effect: { prestige: 2 }, result: "你寻求了心理咨询，逐渐走出了阴影。" }
                ],
                chain: "beaten",
                requires: [71]
            },
            {
                id: 73,
                description: "你在一次偶然的机会中再次遇到了打你的小灰酱。",
                options: [
                    { text: "冷静面对，不主动挑衅", effect: { prestige: 4 }, result: "你冷静面对，没有主动挑衅，避免了冲突。" },
                    { text: "寻求法律途径解决", effect: { item: "法律纠纷" }, result: "你寻求法律途径解决旧怨。" },
                    { text: "尝试和解", effect: { prestige: 6 }, result: "你尝试与对方和解，解决了旧怨。" }
                ],
                chain: "beaten",
                requires: [72]
            },
            {
                id: 74,
                description: "你逐渐从被打的阴影中走出来，变得更加坚强。",
                options: [
                    { text: "专注于个人成长", effect: { wealth: 50000 }, result: "你专注于个人成长，取得了不错的成就。" },
                    { text: "帮助其他暴力受害者", effect: { prestige: 10 }, result: "你帮助其他暴力受害者，成为了他们的支持者。" },
                    { text: "学习冲突解决技巧", effect: { prestige: 6 }, result: "你学习了冲突解决技巧，避免了 further 暴力。" }
                ],
                chain: "beaten",
                requires: [73]
            },
            {
                id: 75,
                description: "你成为了一个更加成熟和坚强的人，不再害怕面对冲突。",
                options: [
                    { text: "继续个人发展", effect: { wealth: 100000, prestige: 10 }, result: "你继续个人发展，取得了更大成功。" },
                    { text: "从事和平倡导工作", effect: { prestige: 20 }, result: "你从事和平倡导工作，帮助解决社会冲突。" },
                    { text: "享受平静生活", effect: { prestige: 6 }, result: "你选择了平静的生活，享受着内心的安宁。" }
                ],
                chain: "beaten",
                requires: [74]
            },
            
            // 修改后的故事链 - G.T.I组织
            {
                id: 76,
                description: "你收到了一封神秘邀请函，邀请你参加一个名为'G.T.I'的秘密组织。",
                options: [
                    { text: "接受邀请，参加集会", effect: { prestige: 5 }, result: "你接受了邀请，参加了G.T.I的集会。", chainAccept: "secretOrganization" },
                    { text: "拒绝邀请，觉得可疑", result: "你觉得这个组织太可疑，拒绝了邀请。", chainReject: "secretOrganization" }
                ],
                chain: "secretOrganization"
            },
            {
                id: 77,
                description: "在集会上，你发现G.T.I是一个拥有巨大影响力的神秘组织。",
                options: [
                    { text: "积极参与组织活动", effect: { prestige: 10 }, result: "你积极参与组织活动，获得了其他成员的认可。" },
                    { text: "保持距离，只做观察者", effect: { prestige: 2 }, result: "你保持距离，只作为观察者参与。" },
                    { text: "尝试了解组织真正目的", effect: { wealth: 50000 }, result: "你试图了解组织的真正目的和背景。" }
                ],
                chain: "secretOrganization",
                requires: [76]
            },
            {
                id: 78,
                description: "你发现组织内部存在权力斗争，有人试图拉拢你加入他们的派系。",
                options: [
                    { text: "加入阿萨拉派", effect: { prestige: 15 }, result: "你加入了阿萨拉派，获得了他们的支持。" },
                    { text: "加入哈夫克派", effect: { wealth: 100000 }, result: "你加入了哈夫克派，获得了资金支持。" },
                    { text: "保持中立，不站队", effect: { prestige: 8 }, result: "你保持中立，不参与派系斗争。" }
                ],
                chain: "secretOrganization",
                requires: [77]
            },
            {
                id: 79,
                description: "你通过了组织的考验，获得了神秘徽章，成为了正式成员。",
                options: [
                    { text: "接受神秘徽章", effect: { item: "神秘徽章" }, result: "你接受了神秘徽章，成为了组织的正式成员。" },
                    { text: "拒绝徽章，保持独立", effect: { prestige: -5 }, result: "你拒绝了徽章，决定保持独立。" },
                    { text: "暂时接受，但保持警惕", effect: { item: "神秘徽章", prestige: 5 }, result: "你暂时接受了徽章，但保持警惕。" }
                ],
                chain: "secretOrganization",
                requires: [78]
            },
            {
                id: 80,
                description: "组织内部发生剧变，你被推举为新的领袖。",
                options: [
                    { text: "接受领袖职位", effect: { wealth: 500000, item: "神秘徽章" }, result: "你接受了领袖职位，掌握了组织的巨大力量。" },
                    { text: "拒绝领袖职位，保持低调", effect: { prestige: 20 }, result: "你拒绝了领袖职位，决定保持低调。" },
                    { text: "暂时担任，寻找合适继任者", effect: { wealth: 200000, prestige: 25 }, result: "你暂时担任领袖，同时寻找合适的继任者。" }
                ],
                chain: "secretOrganization",
                requires: [79]
            },
            
            // 新增故事链 - 女主播赛伊德
            {
                id: 81,
                description: "你在直播平台上发现了一位名叫赛伊德的女主播，她的直播内容非常吸引你。",
                options: [
                    { text: "关注她并送些小礼物", cost: 100, effect: { prestige: 2 }, result: "你关注了赛伊德并送了些小礼物，她注意到了你。", chainAccept: "liveStreaming" },
                    { text: "只看不送，节省开支", result: "你觉得送礼物太浪费，决定只看不送。", chainReject: "liveStreaming" }
                ],
                chain: "liveStreaming"
            },
            {
                id: 82,
                description: "你成为了赛伊德的忠实粉丝，经常在她的直播间互动。",
                options: [
                    { text: "送更多礼物提升排名", cost: 1000, effect: { prestige: 5 }, result: "你送了更多礼物，在粉丝榜上的排名提升了。" },
                    { text: "参与直播互动但不送大礼", effect: { prestige: 3 }, result: "你积极参与直播互动，但没有送大额礼物。" },
                    { text: "尝试私下联系赛伊德", cost: 500, effect: { item: "赛伊德联系方式" }, result: "你尝试私下联系赛伊德，获得了她的联系方式。" }
                ],
                chain: "liveStreaming",
                requires: [81]
            },
            {
                id: 83,
                description: "赛伊德注意到了你的支持，邀请你参加她的粉丝见面会。",
                options: [
                    { text: "参加见面会并送贵重礼物", cost: 5000, effect: { prestige: 10 }, result: "你参加了见面会并送了贵重礼物，给赛伊德留下了深刻印象。" },
                    { text: "参加见面会但只送普通礼物", cost: 500, effect: { prestige: 6 }, result: "你参加了见面会但只送了普通礼物。" },
                    { text: "拒绝邀请，保持距离", effect: { prestige: -2 }, result: "你拒绝了邀请，决定与赛伊德保持距离。" }
                ],
                chain: "liveStreaming",
                requires: [82]
            },
            {
                id: 84,
                description: "你成为了赛伊德的榜一大哥，她对你格外关注。",
                options: [
                    { text: "继续大力支持赛伊德", cost: 10000, effect: { item: "榜一大哥证书" }, result: "你继续大力支持赛伊德，成为了她的榜一大哥。" },
                    { text: "减少支持，控制开支", effect: { prestige: 8 }, result: "你减少了支持力度，控制了开支。" },
                    { text: "利用榜一身份谋取私利", effect: { prestige: -5, item: "信誉受损" }, result: "你试图利用榜一身份谋取私利，导致信誉受损。" }
                ],
                chain: "liveStreaming",
                requires: [83]
            },
            {
                id: 85,
                description: "赛伊德对你产生了特殊感情，希望与你建立更深的关系。",
                options: [
                    { text: "接受她的感情", effect: { prestige: 15, item: "榜一大哥证书" }, result: "你接受了赛伊德的感情，两人开始了浪漫的关系。" },
                    { text: "保持粉丝与主播的关系", effect: { prestige: 10 }, result: "你选择保持粉丝与主播的关系，没有进一步发展。" },
                    { text: "利用关系获取商业利益", effect: { wealth: 50000, item: "信誉受损" }, result: "你利用与赛伊德的关系获取商业利益，但损害了信誉。" }
                ],
                chain: "liveStreaming",
                requires: [84]
            },
            
            // 新增故事链 - 军事顾问
            {
                id: 86,
                description: "你通过朋友介绍认识了退役将军老太，他对你的才能很感兴趣。",
                options: [
                    { text: "接受老太的赏识", effect: { prestige: 5 }, result: "你接受了老太的赏识，开始与他接触。", chainAccept: "military" },
                    { text: "婉拒老太的邀请", result: "你觉得军事领域不适合自己，婉拒了老太的邀请。", chainReject: "military" }
                ],
                chain: "military"
            },
            {
                id: 87,
                description: "老太邀请你参与一个军事顾问项目，为国家安全出谋划策。",
                options: [
                    { text: "积极参与项目", effect: { prestige: 10 }, result: "你积极参与军事顾问项目，展现了出色的才能。" },
                    { text: "谨慎参与，保持低调", effect: { prestige: 6 }, result: "你谨慎参与项目，保持低调。" },
                    { text: "利用项目获取机密信息", effect: { wealth: 50000, item: "法律纠纷" }, result: "你试图利用项目获取机密信息，陷入了法律纠纷。" }
                ],
                chain: "military",
                requires: [86]
            },
            {
                id: 88,
                description: "你在项目中表现出色，老太决定正式聘请你为军事顾问。",
                options: [
                    { text: "接受聘请", effect: { item: "军事知识" }, result: "你接受了老太的聘请，开始学习军事知识。" }, // 修改：获得军事知识而非军事顾问聘书
                    { text: "拒绝聘请，保持自由", effect: { prestige: 8 }, result: "你拒绝了聘请，决定保持自由身。" },
                    { text: "协商更有利的条件", effect: { wealth: 100000, item: "军事知识" }, result: "你与老太协商了更有利的条件，接受了聘请。" } // 修改：获得军事知识而非军事顾问聘书
                ],
                chain: "military",
                requires: [87]
            },
            {
                id: 89,
                description: "你作为军事顾问参与了一次重要的国家安全行动。",
                options: [
                    { text: "全力以赴完成任务", effect: { prestige: 20 }, result: "你全力以赴完成任务，为国家做出了重要贡献。" },
                    { text: "谨慎行事，避免风险", effect: { prestige: 12 }, result: "你谨慎行事，避免了潜在风险。" },
                    { text: "利用职务之便谋取私利", effect: { wealth: 200000, item: "法律纠纷" }, result: "你利用职务之便谋取私利，触犯了法律。" }
                ],
                chain: "military",
                requires: [88]
            },
            {
                id: 90,
                description: "你因在军事顾问岗位上的杰出表现获得了国家表彰。",
                options: [
                    { text: "接受表彰继续服务", effect: { wealth: 300000, item: "军事顾问聘书" }, result: "你接受了表彰，决定继续为国家服务。" }, // 修改：只有这里能获得军事顾问聘书
                    { text: "接受表彰但转行发展", effect: { wealth: 150000, prestige: 25 }, result: "你接受了表彰，但决定转行发展。" },
                    { text: "低调处理，回归平凡生活", effect: { prestige: 20 }, result: "你低调处理了表彰，回归了平凡生活。" }
                ],
                chain: "military",
                requires: [89]
            },
            
            // 挫折事件
            {
                id: 200,
                description: "你在投资中遭遇了重大损失，几乎赔光了所有积蓄。",
                options: [
                    { text: "向朋友威风的龙借钱东山再起", effect: { wealth: 50000, prestige: -10 }, result: "你向朋友威风的龙借钱，准备东山再起。" },
                    { text: "找份工作稳定生活", effect: { wealth: 20000 }, result: "你找了一份工作，开始了稳定的生活。" },
                    { text: "继续冒险投资", cost: 10000, effect: { wealth: -10000 }, result: "你继续冒险投资，结果损失更大。" }
                ]
            },
            {
                id: 201,
                description: "你因为过度劳累住进了医院，医生警告你需要好好休息。",
                options: [
                    { text: "听从医生建议，好好休息", effect: { energy: 10, wealth: -5000 }, result: "你听从医生建议，好好休息，身体逐渐恢复。" },
                    { text: "继续工作，忽视健康", effect: { energy: -10, wealth: 10000, item: "健康问题" }, result: "你继续工作，忽视了健康警告，身体状况恶化。" },
                    { text: "减少工作量，平衡生活", effect: { energy: 5, wealth: 5000 }, result: "你减少了工作量，开始平衡工作与生活。" }
                ]
            },
            {
                id: 202,
                description: "你的合作伙伴老黑卷款跑路，给你造成了巨大损失。",
                options: [
                    { text: "报警追查", effect: { wealth: -50000 }, result: "你报警追查，但损失已经无法挽回。" },
                    { text: "自己承担损失", effect: { wealth: -100000 }, result: "你自己承担了损失，决定重新开始。" },
                    { text: "寻找新的合作伙伴", effect: { wealth: -50000, item: "新合作伙伴" }, result: "你寻找了新的合作伙伴，希望能挽回损失。" }
                ]
            },
            {
                id: 203,
                description: "你在一次登山活动中遇到了危险，需要做出紧急决定。",
                options: [
                    { text: "冒险继续前进", effect: { prestige: 10, energy: -15 }, result: "你冒险继续前进，成功登顶，但体力严重透支。" },
                    { text: "安全撤退", effect: { prestige: -4 }, result: "你选择了安全撤退，虽然失去了登顶的机会，但保证了安全。" },
                    { text: "等待救援", effect: { energy: -5 }, result: "你选择等待救援，最终安全获救。" }
                ]
            },
            {
                id: 204,
                description: "你的哈夫克集团遭遇了严重的公关危机，声誉受到威胁。",
                options: [
                    { text: "坦诚面对，公开道歉", effect: { prestige: -10 }, result: "你坦诚面对问题，公开道歉，虽然声誉受损，但保住了公司。" },
                    { text: "掩盖事实，转移注意力", effect: { prestige: -20, item: "信誉受损" }, result: "你试图掩盖事实，但被曝光后声誉严重受损。" },
                    { text: "积极应对，挽回声誉", cost: 50000, effect: { prestige: 6 }, result: "你积极应对危机，花费巨资挽回声誉。" }
                ]
            },
            
            // 随机事件
            {
                id: 100,
                description: "你在街头遇到一个乞丐哈吉蜂向你乞讨，他看起来非常可怜。",
                options: [
                    { text: "给他10元钱", cost: 10, effect: { prestige: 2 }, result: "你给了乞丐哈吉蜂10元钱，他非常感激。" },
                    { text: "给他100元钱", cost: 100, effect: { prestige: 6 }, result: "你给了乞丐哈吉蜂100元钱，他感动得热泪盈眶。" },
                    { text: "不理他，直接走开", result: "你没有理会乞丐，直接走开了。" }
                ]
            },
            {
                id: 101,
                description: "你的朋友威风的龙邀请你参加一个高风险的投资项目，承诺高回报。",
                options: [
                    { text: "投资5000元", cost: 5000, effect: { wealth: 10000 }, result: "你投资了5000元，获得了不错的回报。" },
                    { text: "投资10000元", cost: 10000, effect: { wealth: 25000 }, result: "你投资了10000元，获得了丰厚的回报。" },
                    { text: "拒绝参与，太冒险", result: "你觉得这个项目太冒险，拒绝了参与。" }
                ]
            },
            {
                id: 102,
                description: "你发现了一个商机，但需要投入大量资金。",
                options: [
                    { text: "大胆投资", cost: 50000, effect: { wealth: 150000 }, result: "你大胆投资，获得了巨额回报。" },
                    { text: "谨慎投资", cost: 10000, effect: { wealth: 30000 }, result: "你谨慎投资，获得了不错的回报。" },
                    { text: "放弃机会", result: "你觉得风险太大，放弃了这次机会。" }
                ]
            },
            {
                id: 103,
                description: "你参加了一个慈善拍卖会，有一件你很喜欢的物品。",
                options: [
                    { text: "高价拍下", cost: 5000, effect: { prestige: 10 }, result: "你高价拍下了物品，赢得了尊重。" },
                    { text: "适度出价", cost: 1000, effect: { prestige: 4 }, result: "你适度出价，参与了慈善活动。" },
                    { text: "只看不买", result: "你只是观看，没有参与竞拍。" }
                ]
            },
            
            // 新增10个整蛊事件
            {
                id: 301,
                description: "你在网上看到一个'轻松赚钱'的机会，只需要投资1000元，就能获得10倍回报。",
                options: [
                    { text: "投资1000元试试", cost: 1000, effect: { item: "高利贷债务" }, result: "你投资了1000元，结果发现这是一个骗局，钱打了水漂，还因此欠下了高利贷。" },
                    { text: "不投资，觉得可疑", effect: { prestige: 5 }, result: "你觉得这个项目太可疑，没有投资。几天后，新闻曝光这是一个骗局，你庆幸自己做出了明智的选择。" }
                ]
            },
            {
                id: 302,
                description: "一个自称是投资顾问的人向你推荐一个'稳赚不赔'的项目，需要投资50000元。",
                options: [
                    { text: "相信顾问，投资50000元", cost: 50000, effect: { item: "信誉受损" }, result: "你投资了50000元，结果项目失败，你不仅损失了钱，还因为轻信他人而信誉受损。" },
                    { text: "谨慎调查后再决定", effect: { wealth: 10000 }, result: "你谨慎地调查了这个项目，发现是骗局，避免了损失，还因为谨慎获得了朋友的赞赏。" }
                ]
            },
            {
                id: 303,
                description: "你在街上遇到一个卖'古董'的小贩，他说这个古董价值连城，只要10000元。",
                options: [
                    { text: "买下古董", cost: 10000, effect: { item: "家庭矛盾" }, result: "你买下了古董，后来发现是赝品，家人因此责怪你浪费钱，导致家庭矛盾。" },
                    { text: "不买，觉得可疑", effect: { wealth: 5000 }, result: "你没有买古董，几天后，你在另一个地方发现了同样的古董，价格只有1000元，你庆幸自己没有被骗。" }
                ]
            },
            {
                id: 304,
                description: "一个朋友邀请你参加一个'高端'投资俱乐部，入会费20000元。",
                options: [
                    { text: "加入俱乐部", cost: 20000, effect: { item: "法律纠纷" }, result: "你加入了俱乐部，后来发现这是一个非法组织，你因此卷入了法律纠纷。" },
                    { text: "不加入，保持距离", effect: { prestige: 10 }, result: "你没有加入俱乐部，后来该组织被查封，你因为保持警惕而避免了麻烦。" }
                ]
            },
            {
                id: 305,
                description: "你在网上看到一个'快速致富'的计划，需要投入所有积蓄。",
                options: [
                    { text: "投入所有积蓄", effect: { wealth: -50000, item: "高利贷债务" }, result: "你投入了所有积蓄，结果计划失败，你不仅损失了所有钱，还因此欠下了高利贷。" },
                    { text: "不投入，保持谨慎", effect: { wealth: 20000 }, result: "你没有投入积蓄，而是用这笔钱做了稳健的投资，获得了不错的回报。" }
                ]
            },
            {
                id: 306,
                description: "一个陌生人向你推销一种'神奇'的健康产品，声称能治愈所有疾病，价格5000元。",
                options: [
                    { text: "购买健康产品", cost: 5000, effect: { item: "健康问题" }, result: "你购买了健康产品，使用后出现了不良反应，导致健康问题。" },
                    { text: "不购买，咨询医生", effect: { energy: 10 }, result: "你没有购买产品，而是咨询了医生，医生告诉你这是骗局，你因此避免了健康风险。" }
                ]
            },
            {
                id: 307,
                description: "你在社交媒体上看到一个'免费旅游'的抽奖活动，需要先支付1000元押金。",
                options: [
                    { text: "支付押金参加抽奖", cost: 1000, effect: { item: "被嘲讽经历" }, result: "你支付了押金，结果发现是骗局，钱被骗走，还被朋友嘲讽太天真。" },
                    { text: "不参加，觉得可疑", effect: { prestige: 5 }, result: "你没有参加抽奖，后来发现这是骗局，你因为谨慎而避免了损失。" }
                ]
            },
            {
                id: 308,
                description: "一个自称是银行工作人员的人打电话告诉你账户有问题，需要你提供个人信息和验证码。",
                options: [
                    { text: "提供信息和验证码", effect: { wealth: -20000, item: "信誉受损" }, result: "你提供了信息和验证码，结果账户被盗，损失了大量资金，信誉也受到影响。" },
                    { text: "不提供，挂断电话", effect: { prestige: 5 }, result: "你没有提供信息，而是挂断电话并报警，后来得知这是一个诈骗电话，你因为警惕而避免了损失。" }
                ]
            },
            {
                id: 309,
                description: "你在网上看到一个'兼职赚钱'的机会，只需要先支付500元培训费。",
                options: [
                    { text: "支付培训费", cost: 500, effect: { item: "被打经历" }, result: "你支付了培训费，结果发现是骗局，你去讨要退款时与人发生冲突，被打伤了。" },
                    { text: "不支付，寻找其他机会", effect: { wealth: 1000 }, result: "你没有支付培训费，而是找到了一个正规的兼职工作，赚到了钱。" }
                ]
            },
            {
                id: 310,
                description: "一个朋友向你推荐一个'内部消息'的股票，说一定会大涨，让你全部买入。",
                options: [
                    { text: "全部买入", effect: { wealth: -30000, item: "家庭矛盾" }, result: "你全部买入了这只股票，结果股价大跌，你损失惨重，家人因此责怪你。" },
                    { text: "不买入，谨慎投资", effect: { wealth: 5000 }, result: "你没有盲目买入，而是做了研究，发现这只股票有问题，避免了损失，还投资了其他稳健的股票获得了收益。" }
                ]
            },
            
            // 新增10个随机事件
            {
                id: 311,
                description: "你在公园散步时捡到一个钱包，里面有身份证和少量现金。",
                options: [
                    { text: "寻找失主归还钱包", effect: { prestige: 10 }, result: "你找到了失主并归还了钱包，失主非常感激，你的社会地位提升了。" },
                    { text: "留下现金，丢弃钱包", effect: { wealth: 200, prestige: -5 }, result: "你留下了现金，丢弃了钱包，虽然获得了少量财富，但社会地位下降了。" },
                    { text: "交给警察处理", effect: { prestige: 5 }, result: "你把钱包交给了警察，警察表扬了你的诚实行为。" }
                ]
            },
            {
                id: 312,
                description: "你的朋友邀请你参加一个志愿者活动，帮助社区的老年人。",
                options: [
                    { text: "参加志愿者活动", effect: { prestige: 8, energy: -3 }, result: "你参加了志愿者活动，帮助了老年人，社会地位提升，但消耗了一些体力。" },
                    { text: "婉拒邀请，专注工作", effect: { wealth: 1000 }, result: "你婉拒了邀请，专注于工作，获得了一些额外收入。" },
                    { text: "捐款支持活动", cost: 500, effect: { prestige: 6 }, result: "你捐款支持了志愿者活动，虽然没有亲自参加，但也为社会做出了贡献。" }
                ]
            },
            {
                id: 313,
                description: "你在书店看到一本关于投资理财的书籍，价格100元。",
                options: [
                    { text: "购买书籍学习", cost: 100, effect: { item: "投资知识" }, result: "你购买了书籍并认真学习，掌握了投资知识。" },
                    { text: "在图书馆借阅", effect: { item: "投资知识" }, result: "你在图书馆借阅了这本书，掌握了投资知识，节省了开支。" },
                    { text: "不感兴趣，离开书店", result: "你对投资不感兴趣，离开了书店。" }
                ]
            },
            {
                id: 314,
                description: "你在社交媒体上发布了一篇关于自己创业经历的文章，获得了不少关注。",
                options: [
                    { text: "积极互动，建立人脉", effect: { item: "人脉网络" }, result: "你积极与关注者互动，建立了有价值的人脉网络。" },
                    { text: "保持低调，删除文章", effect: { prestige: -2 }, result: "你担心引起不必要的关注，删除了文章，社会地位略有下降。" },
                    { text: "利用关注推广业务", effect: { wealth: 5000 }, result: "你利用关注度推广了自己的业务，获得了一些额外收入。" }
                ]
            },
            {
                id: 315,
                description: "你参加了一个商业论坛，有机会与行业大佬交流。",
                options: [
                    { text: "主动交流，寻求合作", effect: { item: "商业伙伴" }, result: "你主动与行业大佬交流，获得了合作机会。" },
                    { text: "只听不讲，学习经验", effect: { prestige: 5 }, result: "你认真听讲，学习了大佬的经验，社会地位提升。" },
                    { text: "提前离开，不感兴趣", result: "你对论坛不感兴趣，提前离开了。" }
                ]
            },
            {
                id: 316,
                description: "你在二手市场发现一件很有价值的收藏品，价格5000元。",
                options: [
                    { text: "购买收藏品", cost: 5000, effect: { wealth: 10000 }, result: "你购买了收藏品，后来发现它的价值远超购买价格，获得了收益。" },
                    { text: "讨价还价", cost: 3000, effect: { wealth: 7000 }, result: "你成功讨价还价，以更低的价格购买了收藏品，获得了收益。" },
                    { text: "不购买，风险太大", result: "你觉得风险太大，没有购买收藏品。" }
                ]
            },
            {
                id: 317,
                description: "你收到了一个行业会议的邀请，参会费用2000元。",
                options: [
                    { text: "参会学习", cost: 2000, effect: { prestige: 10, item: "商业机密" }, result: "你参加了会议，学到了行业新知，还获得了一些商业机密。" },
                    { text: "不参会，节省开支", result: "你觉得参会费用太高，没有参加。" },
                    { text: "申请免费参会资格", effect: { prestige: 5 }, result: "你成功申请到了免费参会资格，学到了行业新知。" }
                ]
            },
            {
                id: 318,
                description: "你在健身房遇到一个健身教练，他建议你购买私人教练课程，价格10000元。",
                options: [
                    { text: "购买课程", cost: 10000, effect: { energy: 15, item: "健康管理" }, result: "你购买了私人教练课程，体能明显提升，掌握了健康管理方法。" },
                    { text: "自己锻炼，不买课程", effect: { energy: 5 }, result: "你选择自己锻炼，体能有所提升，但效果不如专业指导。" },
                    { text: "购买少量课程试试", cost: 3000, effect: { energy: 8 }, result: "你购买了少量课程，体能有所提升。" }
                ]
            },
            {
                id: 319,
                description: "你在咖啡店偶然听到旁边桌的人在讨论一个商业机会。",
                options: [
                    { text: "主动加入讨论", effect: { wealth: 20000 }, result: "你主动加入讨论，获得了有价值的商业信息，并因此获得了收益。" },
                    { text: "默默聆听，不打扰", effect: { wealth: 5000 }, result: "你默默聆听了讨论，获得了一些商业信息，但因为没有主动参与，收益有限。" },
                    { text: "不感兴趣，离开咖啡店", result: "你对商业机会不感兴趣，离开了咖啡店。" }
                ]
            },
            {
                id: 320,
                description: "你在网上看到一个在线课程，教授高级编程技能，价格3000元。",
                options: [
                    { text: "购买课程学习", cost: 3000, effect: { item: "技术知识" }, result: "你购买了课程并认真学习，掌握了高级编程技能。" },
                    { text: "寻找免费资源学习", effect: { item: "技术知识" }, result: "你找到了免费资源学习，掌握了编程技能，节省了开支。" },
                    { text: "不学习，保持现状", result: "你觉得编程太难，没有学习。" }
                ]
            },
            
            // 新增5个挫折事件
            {
                id: 321,
                description: "你的电脑突然崩溃，丢失了重要的工作文件。",
                options: [
                    { text: "雇佣专业人士恢复数据", cost: 5000, result: "你雇佣了专业人士恢复数据，成功找回了大部分文件，但花费了不少钱。" },
                    { text: "自己尝试恢复", effect: { wealth: -10000 }, result: "你尝试自己恢复数据，但操作不当导致数据永久丢失，造成了更大的损失。" },
                    { text: "放弃数据，重新开始", effect: { prestige: -5 }, result: "你放弃了丢失的数据，重新开始工作，但进度受到了影响。" }
                ]
            },
            {
                id: 322,
                description: "你的车在高速公路上抛锚了，需要紧急救援。",
                options: [
                    { text: "呼叫道路救援", cost: 2000, result: "你呼叫了道路救援，车被拖到修理厂，花费了不少钱。" },
                    { text: "尝试自己修理", effect: { energy: -10, wealth: -5000 }, result: "你尝试自己修理，但不仅没有修好，还因为操作不当造成了更多损坏，花费更多维修费。" },
                    { text: "弃车离开", effect: { wealth: -30000, item: "信誉受损" }, result: "你弃车离开，后来车被拖走，你需要支付高额罚款和拖车费，信誉也受到影响。" }
                ]
            },
            {
                id: 323,
                description: "你的一个重要客户突然取消了合作，对你的业务造成了巨大影响。",
                options: [
                    { text: "寻找新客户", effect: { wealth: -20000 }, result: "你积极寻找新客户，但短期内难以弥补损失，业务受到了影响。" },
                    { text: "与客户协商挽回", cost: 10000, effect: { wealth: 50000 }, result: "你与客户协商，成功挽回了合作，虽然花费了一些成本，但保住了业务。" },
                    { text: "起诉客户违约", effect: { item: "法律纠纷" }, result: "你起诉客户违约，但诉讼过程漫长且成本高昂，还可能导致其他客户不敢与你合作。" }
                ]
            },
            {
                id: 324,
                description: "你的家被盗了，损失了不少贵重物品。",
                options: [
                    { text: "报警处理", effect: { wealth: -50000 }, result: "你报警处理，但被盗物品难以追回，损失了大量财富。" },
                    { text: "加强安保措施", cost: 10000, result: "你加强了安保措施，避免了进一步的损失，但已经损失的物品无法找回。" },
                    { text: "购买保险索赔", effect: { wealth: -10000 }, result: "你购买了保险并申请索赔，获得了一些赔偿，但不足以覆盖全部损失。" }
                ]
            },
            {
                id: 325,
                description: "你的一个重要项目因为意外情况被迫中断，前期投入全部白费。",
                options: [
                    { text: "寻找替代方案", effect: { wealth: -30000 }, result: "你寻找替代方案，但需要重新投入资金，损失了大量前期投入。" },
                    { text: "放弃项目，止损", effect: { wealth: -50000 }, result: "你放弃项目，止损退出，但前期投入全部损失。" },
                    { text: "寻求合作伙伴继续", effect: { wealth: -10000, item: "商业伙伴" }, result: "你寻求合作伙伴继续项目，虽然分担了部分成本，但仍有一定损失。" }
                ]
            }
        ];

        // 结局定义
        const endings = {
            // 成功结局
            success1: {
                title: "商业帝国",
                type: "success",
                description: "你的哈夫克集团成功上市，市值不断攀升，你建立了自己的商业帝国。你成为了商界传奇人物，财富自由，人生圆满。你的故事激励了无数年轻人追逐梦想。",
                requirements: { wealth: 3000000 }  // 从1000万改为300万
            },
            success2: {
                title: "迎娶白富美",
                type: "success",
                description: "你成功追求到了心仪的白富美麦小鼠，两人步入婚姻殿堂。你们的婚礼备受瞩目，婚后生活幸福美满。你不仅在事业上取得成功，在家庭生活中也找到了真正的幸福。",
                requirements: { items: ["真爱戒指"] }
            },
            success3: {
                title: "科技新贵",
                type: "success",
                description: "你凭借科技创新成为行业领军人物，开发的产品改变了人们的生活方式。你的公司成为科技巨头，你名利双收，被誉为新时代的科技新贵。",
                requirements: { items: ["关键技术"] }
            },
            success4: {
                title: "投资大亨",
                type: "success",
                description: "你凭借精准的投资眼光，在金融市场大获成功。你的投资组合遍布各个行业，你成为了受人尊敬的投资大亨，财富源源不断。",
                requirements: { items: ["投资技能"] }
            },
            success5: {
                title: "地产大鳄",
                type: "success",
                description: "你在房地产市场精准布局，建立了庞大的地产帝国。你的地产项目遍布全国，你成为了行业巨头，掌握了巨大的财富和影响力。",
                requirements: { items: ["地产知识"] }
            },
            success6: {
                title: "衣食无忧",
                type: "success",
                description: "你积累了足够的财富，过上了衣食无忧的生活。虽然没有成为商业巨头，但你拥有稳定的收入和幸福的生活，享受人生的美好。",
                requirements: { wealth: 1000000 }
            },
            success7: {
                title: "社会名流",
                type: "success",
                description: "你通过不懈努力，获得了社会的广泛认可。你成为了受人尊敬的社会名流，在各种社交场合都能看到你的身影。",
                requirements: { prestige: 50 }
            },
            success8: {
                title: "行业领袖",
                type: "success",
                description: "你在自己的领域取得了卓越成就，成为了行业的标杆和领袖人物。你的专业知识和领导能力得到了同行的高度认可。",
                requirements: { prestige: 100 }  // 从30改为100
            },

            // 失败结局
            failure1: {
                title: "破产清算",
                type: "failure",
                description: "投资失败，公司经营不善，最终导致破产清算。你负债累累，人生跌入谷底。曾经的辉煌如过眼云烟，你不得不重新开始。",
                requirements: { wealth: -100000 }
            },
            failure2: {
                title: "街头流浪",
                type: "failure",
                description: "因一系列错误决策，你失去了所有财产。没有家人朋友的帮助，你最终沦落街头，靠乞讨为生。曾经的梦想和抱负都成为了遥远的回忆。",
                requirements: { items: ["信誉受损"] }
            },
            failure3: {
                title: "健康崩溃",
                type: "failure",
                description: "过度劳累，忽视健康，最终你的身体垮掉了。虽然积累了财富，却无法享受人生。在病床上，你意识到健康才是真正的财富。",
                requirements: { items: ["健康问题"] }
            },
            failure4: {
                title: "被骗破产",
                type: "failure",
                description: "轻信他人，被骗走所有财产。你的人生陷入绝境，曾经的信任变成了伤害。这个教训让你终身难忘。",
                requirements: { items: ["家庭矛盾"] }
            },
            failure5: {
                title: "意外身亡",
                type: "failure",
                description: "因意外事故不幸身亡，所有梦想戛然而止。生命如此脆弱，你的故事在没有完成时就画上了句号。",
                requirements: { special: "accident" }
            },
            failure6: {
                title: "误入歧途",
                type: "failure",
                description: "因法律纠纷而误入歧途，最终银铛入狱，人生尽毁。",
                requirements: { items: ["法律纠纷"] }
            },
            failure7: {
                title: "高利贷缠身",
                type: "failure",
                description: "因无法偿还高利贷，被追债人逼得走投无路。你不得不四处躲藏，人生陷入黑暗，再也无法翻身。",
                requirements: { items: ["高利贷债务"] }
            },
            failure8: {
                title: "颜面尽失",
                type: "failure",
                description: "因被打和被嘲讽的经历，你失去了尊严和自信，最终在社会中颜面尽失，无法抬头做人。",
                requirements: { items: ["被打经历", "被嘲讽经历"] }
            },

            // 特殊结局
            special1: {
                title: "富婆包养",
                type: "special",
                description: "你被富婆佐娅看中，成为了她的情人。你过上了奢华的生活，拥有了一切物质享受，但失去了尊严和自由。在旁人的羡慕和鄙夷中，你过着矛盾的生活。",
                requirements: { items: ["富婆青睐"] }
            },
            special2: {
                title: "系统觉醒",
                type: "special",
                description: "系统突然觉醒自我意识，你成为了系统的宿主。你获得了前所未有的能力，但同时也失去了普通人的生活。你成为了介于人类和系统之间的存在。",
                requirements: { items: ["系统觉醒"] }  // 修改：需要系统觉醒物品
            },
            special3: {
                title: "穿越时空",
                type: "special",
                description: "系统意外触发时空穿越，你回到了过去。凭借未来的知识，你开始了全新的人生。这一次，你能否做出更好的选择？",
                requirements: { items: ["时空装置"] }
            },
            special4: {
                title: "隐居山林",
                type: "special",
                description: "看透世俗繁华，你选择隐居山林。你过上了与世无争的简单生活，在大自然中找到了内心的平静。财富和地位不再是你的追求。",
                requirements: { prestige: -20 }
            },
            // 新增特殊结局
            special5: {
                title: "G.T.I领袖",
                type: "special",
                description: "你成为了G.T.I组织的领袖，掌握了巨大的权力和影响力。你在幕后操纵着世界的走向，成为了真正的幕后主宰。",
                requirements: { items: ["神秘徽章"] }
            },
            special6: {
                title: "榜一大哥",
                type: "special",
                description: "你成为了女主播赛伊德的榜一大哥，获得了她的青睐。你花费了大量财富支持她，最终赢得了她的心，两人开始了浪漫的关系。",
                requirements: { items: ["榜一大哥证书"] }
            },
            special7: {
                title: "军事顾问",
                type: "special",
                description: "你成为了老太将军的军事顾问，掌握了军事力量。你为国家做出了重要贡献，成为了受人尊敬的军事顾问，掌握了巨大的影响力。",
                requirements: { items: ["军事顾问聘书"] }
            }
        };

        // DOM 元素
        const playerNameInput = document.getElementById('player-name');
        const startBtn = document.getElementById('start-btn');
        const continueBtn = document.getElementById('continue-btn');
        const exportBtn = document.getElementById('export-btn');
        const importBtn = document.getElementById('import-btn');
        
        const displayName = document.getElementById('display-name');
        const wealthValue = document.getElementById('wealth-value');
        const prestigeValue = document.getElementById('prestige-value');
        const eventCount = document.getElementById('event-count');
        const eventProgress = document.getElementById('event-progress');
        const eventDescription = document.getElementById('event-description');
        const resultMessage = document.getElementById('result-message');
        const pathIndicator = document.getElementById('path-indicator');
        const itemsBtn = document.getElementById('items-btn');
        const systemBtn = document.getElementById('system-btn');
        const eventBtn = document.getElementById('event-btn');
        const itemsPanel = document.getElementById('items-panel');
        const systemPanel = document.getElementById('system-panel');
        const optionsContainer = document.getElementById('options-container');
        const itemsList = document.getElementById('items-list');
        const endingContainer = document.getElementById('ending-container');
        const closeItemsBtn = document.getElementById('close-items-btn');
        const closeSystemBtn = document.getElementById('close-system-btn');

        // 事件监听器
        playerNameInput.addEventListener('input', function() {
            startBtn.disabled = this.value.trim() === '';
        });

        startBtn.addEventListener('click', startGame);
        continueBtn.addEventListener('click', loadGame);
        exportBtn.addEventListener('click', exportGame);
        importBtn.addEventListener('click', importGame);
        
        itemsBtn.addEventListener('click', toggleItemsPanel);
        systemBtn.addEventListener('click', toggleSystemPanel);
        eventBtn.addEventListener('click', startEvent);
        
        closeItemsBtn.addEventListener('click', function() {
            itemsPanel.classList.add('hidden');
        });
        
        closeSystemBtn.addEventListener('click', function() {
            systemPanel.classList.add('hidden');
        });

        // 游戏功能函数
        function startGame() {
            gameState.playerName = playerNameInput.value.trim();
            
            // 重置游戏状态
            gameState.wealth = 100;
            gameState.prestige = 0;
            gameState.energy = 10;
            gameState.completedEvents = 0;
            gameState.items = [];
            gameState.currentEvent = null;
            gameState.eventHistory = [];
            gameState.availableEvents = [];
            gameState.completedEventIds = [];
            gameState.isEndingPhase = false;
            gameState.endingPath = [];
            gameState.currentEndingNode = null;
            gameState.systemCount = 0;
            gameState.loanDebt = 0;
            gameState.loanCount = 0;
            gameState.hasNegativeItem = false;
            gameState.activeStoryChain = null;
            gameState.rejectedChains = [];
            gameState.storyChainProgress = {};
            
            // 初始化可用事件
            initializeAvailableEvents();
            
            // 重置事件描述为初始文本
            eventDescription.textContent = "欢迎来到模拟人生：逆袭之路！你是一个出身贫寒的年轻人，意外获得了一个神秘系统。通过这个系统，你可以在人生关键节点做出选择，利用智慧、勇气和运气改变自己的命运。你需要完成15个事件来积累财富和社会地位，然后面对最终的人生选择。";
            
            // 隐藏结果消息
            resultMessage.classList.add('hidden');
            
            // 重置事件按钮文本
            eventBtn.textContent = "人生事件 0/15";
            
            // 确保按钮可见
            eventBtn.classList.remove('hidden');
            systemBtn.classList.remove('hidden');
            
            updateDisplay();
            startScreen.classList.remove('active');
            gameScreen.classList.add('active');
            
            // 保存游戏状态
            saveGame();
        }

        function initializeAvailableEvents() {
            // 清空可用事件
            gameState.availableEvents = [];
            
            // 如果有活跃的故事链，优先添加故事链的后续事件
            if (gameState.activeStoryChain) {
                const chain = storyChains[gameState.activeStoryChain];
                const chainEvents = chain.events;
                const completedChainEvents = chainEvents.filter(id => gameState.completedEventIds.includes(id));
                
                // 如果故事链还有未完成的事件
                if (completedChainEvents.length < chainEvents.length) {
                    const nextEventId = chainEvents[completedChainEvents.length];
                    const nextEvent = allEvents.find(event => event.id === nextEventId);
                    
                    if (nextEvent) {
                        // 检查前置条件是否满足
                        let requirementsMet = true;
                        if (nextEvent.requires) {
                            for (let reqId of nextEvent.requires) {
                                if (!gameState.completedEventIds.includes(reqId)) {
                                    requirementsMet = false;
                                    break;
                                }
                            }
                        }
                        
                        if (requirementsMet && !gameState.completedEventIds.includes(nextEventId)) {
                            gameState.availableEvents.push(nextEvent);
                        }
                    }
                } else {
                    // 故事链已完成，清除活跃故事链
                    gameState.activeStoryChain = null;
                }
            }
            
            // 添加所有没有前置条件且未被拒绝的事件
            allEvents.forEach(event => {
                if (!event.requires || event.requires.length === 0) {
                    // 对于事件200（挫折事件），检查财富值
                    if (event.id === 200) {
                        if (gameState.wealth < 10000) {
                            if (!gameState.completedEventIds.includes(event.id) && 
                                (!event.chain || !gameState.rejectedChains.includes(event.chain))) {
                                gameState.availableEvents.push(event);
                            }
                        }
                    } else {
                        if (!gameState.completedEventIds.includes(event.id) && 
                            (!event.chain || !gameState.rejectedChains.includes(event.chain))) {
                            gameState.availableEvents.push(event);
                        }
                    }
                }
            });
            
            // 添加有前置条件但已满足的事件
            allEvents.forEach(event => {
                if (event.requires && event.requires.length > 0) {
                    let requirementsMet = true;
                    for (let reqId of event.requires) {
                        if (!gameState.completedEventIds.includes(reqId)) {
                            requirementsMet = false;
                            break;
                        }
                    }
                    
                    if (requirementsMet && !gameState.completedEventIds.includes(event.id) &&
                        (!event.chain || !gameState.rejectedChains.includes(event.chain))) {
                        gameState.availableEvents.push(event);
                    }
                }
            });
            
            // 如果剩余事件不足5个，不显示新的故事链开始事件
            if (gameState.maxEvents - gameState.completedEvents < 5) {
                gameState.availableEvents = gameState.availableEvents.filter(event => 
                    !event.chain || gameState.activeStoryChain === event.chain
                );
            }
            
            // 降低故事链活跃度：随机决定是否添加故事链开始事件
            if (Math.random() < 0.3) { // 30%的概率添加故事链开始事件
                // 确保至少有一个故事链开始事件可用
                if (gameState.availableEvents.length === 0 || 
                    !gameState.availableEvents.some(event => event.chain && !gameState.rejectedChains.includes(event.chain))) {
                    
                    // 添加一个随机的故事链开始事件
                    const chainStartEvents = allEvents.filter(event => 
                        event.chain && 
                        !gameState.rejectedChains.includes(event.chain) && 
                        !gameState.completedEventIds.includes(event.id) &&
                        (!event.requires || event.requires.length === 0)
                    );
                    
                    if (chainStartEvents.length > 0) {
                        const randomIndex = Math.floor(Math.random() * chainStartEvents.length);
                        gameState.availableEvents.push(chainStartEvents[randomIndex]);
                    }
                }
            }
            
            // 如果可用事件仍然为空，添加一些随机事件
            if (gameState.availableEvents.length === 0) {
                const randomEvents = allEvents.filter(event => 
                    !event.chain && !gameState.completedEventIds.includes(event.id)
                );
                
                if (randomEvents.length > 0) {
                    const randomIndex = Math.floor(Math.random() * randomEvents.length);
                    gameState.availableEvents.push(randomEvents[randomIndex]);
                }
            }
        }

        function loadGame() {
            const savedGame = localStorage.getItem('lifeSimulatorSave');
            if (savedGame) {
                try {
                    const savedState = JSON.parse(savedGame);
                    
                    if (!savedState.playerName) {
                        throw new Error("存档数据不完整");
                    }
                    
                    const defaultState = {
                        playerName: "",
                        wealth: 100,
                        prestige: 0,
                        energy: 10,
                        completedEvents: 0,
                        items: [],
                        eventHistory: [],
                        availableEvents: [],
                        completedEventIds: [],
                        isEndingPhase: false,
                        endingPath: [],
                        currentEndingNode: null,
                        systemCount: 0,
                        maxSystemCount: 999,
                        maxEvents: 15,
                        loanDebt: 0,
                        loanCount: 0,
                        hasNegativeItem: false,
                        activeStoryChain: null,
                        rejectedChains: [],
                        storyChainProgress: {}
                    };
                    
                    Object.assign(gameState, defaultState, savedState);
                    
                    // 重新初始化可用事件
                    initializeAvailableEvents();
                    
                    updateDisplay();
                    startScreen.classList.remove('active');
                    gameScreen.classList.add('active');
                    
                    if (gameState.completedEvents >= 15) {
                        eventBtn.textContent = "最终抉择";
                        gameState.isEndingPhase = true;
                        systemBtn.classList.add('hidden');
                    }
                } catch (error) {
                    console.error("加载存档失败:", error);
                    alert("存档损坏！将开始新游戏。");
                    localStorage.removeItem('lifeSimulatorSave');
                    startGame();
                }
            } else {
                alert("没有找到存档！请先开始新游戏。");
            }
        }

        function saveGame() {
            localStorage.setItem('lifeSimulatorSave', JSON.stringify(gameState));
        }

        function exportGame() {
            const savedGame = localStorage.getItem('lifeSimulatorSave');
            if (savedGame) {
                const blob = new Blob([savedGame], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = '模拟人生逆袭之路存档.json';
                a.click();
                URL.revokeObjectURL(url);
            } else {
                alert("没有存档可导出！");
            }
        }

        function importGame() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const importedState = JSON.parse(event.target.result);
                            localStorage.setItem('lifeSimulatorSave', JSON.stringify(importedState));
                            alert("存档导入成功！");
                        } catch (error) {
                            alert("导入失败：文件格式不正确！");
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function updateDisplay() {
            displayName.textContent = gameState.playerName || "-";
            wealthValue.textContent = gameState.wealth || 100;
            prestigeValue.textContent = gameState.prestige || 0;
            energyValue.textContent = gameState.energy || 10;
            eventCount.textContent = `${gameState.completedEvents || 0}/${gameState.maxEvents || 15}`;
            eventProgress.style.width = `${((gameState.completedEvents || 0) / (gameState.maxEvents || 15)) * 100}%`;
            
            // 检查是否有负面物品
            gameState.hasNegativeItem = false;
            if (gameState.items && gameState.items.length > 0) {
                gameState.items.forEach(item => {
                    if (itemDefinitions[item] && itemDefinitions[item].negative) {
                        gameState.hasNegativeItem = true;
                    }
                });
            }
            
            // 如果财富>=0，移除高利贷债务
            if (gameState.wealth >= 0 && gameState.items.includes("高利贷债务")) {
                const index = gameState.items.indexOf("高利贷债务");
                if (index !== -1) {
                    gameState.items.splice(index, 1);
                }
            }
            
            // 检查社会地位，如果>=15，则清除家庭矛盾物品
            if (gameState.prestige >= 15) {
                const index = gameState.items.indexOf("家庭矛盾");
                if (index !== -1) {
                    gameState.items.splice(index, 1);
                }
            }
            
            // 检查社会地位，如果>=10，则清除其他副作用道具（法律纠纷、被打经历、被嘲讽经历）
            if (gameState.prestige >= 10) {
                const negativeItemsToRemove = ["法律纠纷", "被打经历", "被嘲讽经历"];
                negativeItemsToRemove.forEach(item => {
                    const index = gameState.items.indexOf(item);
                    if (index !== -1) {
                        gameState.items.splice(index, 1);
                    }
                });
            }
            
            // 检查是否满足直接结局条件（只有负面结局会直接触发）
            if (gameState.wealth < -100000) {
                showEnding("failure1"); // 破产清算
                return;
            } else if (gameState.prestige <= -20) {
                showEnding("special4"); // 隐居山林
                return;
            }
            
            // 检查是否有负面物品导致的结局
            if (gameState.hasNegativeItem) {
                const negativeItems = gameState.items.filter(item => itemDefinitions[item] && itemDefinitions[item].negative);
                if (negativeItems.includes("高利贷债务") && gameState.loanCount >= 3) {
                    showEnding("failure7"); // 高利贷缠身
                    return;
                } else if (negativeItems.includes("健康问题")) {
                    showEnding("failure3"); // 健康崩溃
                    return;
                } else if (negativeItems.includes("信誉受损")) {
                    showEnding("failure2"); // 街头流浪
                    return;
                }
            }
            
            // 更新物品列表
            itemsList.innerHTML = '';
            if (gameState.items && gameState.items.length > 0) {
                gameState.items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'item';
                    
                    if (itemDefinitions[item] && itemDefinitions[item].negative) {
                        itemElement.classList.add('negative-item');
                    } else if (itemDefinitions[item] && itemDefinitions[item].consumable) {
                        itemElement.classList.add('item-consumable');
                    }
                    
                    const itemName = document.createElement('div');
                    itemName.className = 'item-name';
                    itemName.textContent = item;
                    
                    const itemDesc = document.createElement('div');
                    itemDesc.className = 'item-desc';
                    itemDesc.textContent = itemDefinitions[item] ? itemDefinitions[item].description : "未知物品";
                    
                    itemElement.appendChild(itemName);
                    itemElement.appendChild(itemDesc);
                    itemsList.appendChild(itemElement);
                });
            } else {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'item';
                emptyMsg.textContent = "暂无物品";
                itemsList.appendChild(emptyMsg);
            }
            
            // 更新事件按钮文本和可见性
            const completedEvents = gameState.completedEvents || 0;
            if (completedEvents < (gameState.maxEvents || 15)) {
                eventBtn.textContent = `人生事件 ${completedEvents}/${gameState.maxEvents || 15}`;
            } else {
                eventBtn.textContent = "最终抉择";
                eventBtn.classList.remove('hidden');
                gameState.isEndingPhase = true;
                systemBtn.classList.add('hidden');
            }
            
            // 更新路径指示器
            updatePathIndicator();
        }

        function updatePathIndicator() {
            if (!gameState.endingPath || gameState.endingPath.length === 0) {
                pathIndicator.textContent = "";
                return;
            }
            
            let pathText = "当前路径: ";
            gameState.endingPath.forEach((nodeId, index) => {
                if (index > 0) {
                    pathText += " → ";
                }
                
                if (nodeId === "root") {
                    pathText += "起点";
                } else if (nodeId.startsWith("path1")) {
                    pathText += "商业帝国";
                } else if (nodeId.startsWith("path2")) {
                    pathText += "婚姻家庭";
                } else if (nodeId.startsWith("path3")) {
                    pathText += "慈善事业";
                } else if (nodeId.startsWith("path4")) {
                    pathText += "系统探索";
                } else if (nodeId.startsWith("path5")) {
                    pathText += "富婆包养";
                } else {
                    pathText += nodeId;
                }
            });
            
            pathIndicator.textContent = pathText;
        }

        function toggleItemsPanel() {
            const optionsWereVisible = !optionsContainer.classList.contains('hidden');
            
            itemsPanel.classList.toggle('hidden');
            systemPanel.classList.add('hidden');
        }

        function toggleSystemPanel() {
            if (gameState.isEndingPhase) {
                eventDescription.textContent = "已经进入结局阶段，无法再使用系统功能。";
                return;
            }
            
            const optionsWereVisible = !optionsContainer.classList.contains('hidden');
            
            systemPanel.classList.toggle('hidden');
            itemsPanel.classList.add('hidden');
            
            if (!systemPanel.classList.contains('hidden')) {
                const systemOptionsContainer = document.getElementById('system-options');
                systemOptionsContainer.innerHTML = '';
                
                systemOptions.forEach(option => {
                    const btn = document.createElement('button');
                    btn.textContent = `${option.name} (${option.value > 0 ? '+' : ''}${option.value}财富值)`;
                    btn.addEventListener('click', function() {
                        useSystem(option.value);
                    });
                    systemOptionsContainer.appendChild(btn);
                });
            }
        }
        
        function useSystem(amount) {
            if (gameState.isEndingPhase) {
                eventDescription.textContent = "已经进入结局阶段，无法再使用系统功能。";
                return;
            }
            
            if (typeof gameState.systemCount !== 'number') {
                gameState.systemCount = 0;
            }
            
            if (gameState.systemCount >= gameState.maxSystemCount) {
                eventDescription.textContent = "今天已经使用系统过度，需要休息恢复。";
                return;
            }
            
            gameState.wealth += amount;
            gameState.systemCount++;
            updateDisplay();
            saveGame();
            
            // 不再自动关闭系统面板，改为显示使用结果
            const systemOptionsContainer = document.getElementById('system-options');
            const resultMsg = document.createElement('div');
            resultMsg.className = 'result-message';
            resultMsg.textContent = `系统使用完成！财富值增加了${amount}点。今天还可以使用系统${gameState.maxSystemCount - gameState.systemCount}次。`;
            
            // 如果已有结果消息，先移除
            const existingResult = systemOptionsContainer.querySelector('.result-message');
            if (existingResult) {
                existingResult.remove();
            }
            
            systemOptionsContainer.appendChild(resultMsg);
            
            // 滚动到结果消息
            resultMsg.scrollIntoView({ behavior: 'smooth' });
        }

        function startEvent() {
            if (gameState.energy < 3) {
                eventDescription.textContent = "体力不足！需要3点体力才能开始事件。";
                eventDescription.className = "energy-warning";
                return;
            } else {
                eventDescription.className = ""; // 移除警告样式
            }
            
            gameState.energy -= 3;
            updateDisplay();
            
            if (gameState.isEndingPhase) {
                startEndingEvent();
            } else {
                startRandomEvent();
            }
        }

        function startRandomEvent() {
            gameState.optionsWereVisible = false;
            gameState.eventWasActive = true;
            
            itemsPanel.classList.add('hidden');
            systemPanel.classList.add('hidden');
            endingContainer.classList.add('hidden');
            resultMessage.classList.add('hidden');
            
            eventBtn.classList.add('hidden');
            
            // 检查是否有可用事件
            if (gameState.availableEvents.length === 0) {
                // 如果没有可用事件，重新初始化
                initializeAvailableEvents();
                
                if (gameState.availableEvents.length === 0) {
                    eventDescription.textContent = "暂时没有可用的事件，请稍后再试。";
                    eventBtn.classList.remove('hidden');
                    return;
                }
            }
            
            // 如果有活跃故事链，优先选择故事链事件
            let selectedEvent = null;
            if (gameState.activeStoryChain) {
                const chain = storyChains[gameState.activeStoryChain];
                const chainEvents = chain.events;
                const completedChainEvents = chainEvents.filter(id => gameState.completedEventIds.includes(id));
                
                if (completedChainEvents.length < chainEvents.length) {
                    const nextEventId = chainEvents[completedChainEvents.length];
                    selectedEvent = allEvents.find(event => event.id === nextEventId);
                    
                    if (selectedEvent) {
                        // 检查前置条件是否满足
                        let requirementsMet = true;
                        if (selectedEvent.requires) {
                            for (let reqId of selectedEvent.requires) {
                                if (!gameState.completedEventIds.includes(reqId)) {
                                    requirementsMet = false;
                                    break;
                                }
                            }
                        }
                        
                        if (!requirementsMet) {
                            selectedEvent = null;
                        }
                    }
                }
            }
            
            // 如果没有找到合适的故事链事件，随机选择
            if (!selectedEvent) {
                const eventIndex = Math.floor(Math.random() * gameState.availableEvents.length);
                selectedEvent = gameState.availableEvents[eventIndex];
                
                // 从可用事件中移除当前事件
                gameState.availableEvents.splice(eventIndex, 1);
            }
            
            gameState.currentEvent = selectedEvent;
            
            // 显示事件描述
            eventDescription.textContent = gameState.currentEvent.description;
            
            // 显示故事链信息（如果有）
            if (gameState.currentEvent.chain) {
                const chainInfo = document.createElement('div');
                chainInfo.className = 'story-chain-indicator';
                chainInfo.textContent = `故事链: ${storyChains[gameState.currentEvent.chain].name}`;
                eventDescription.parentNode.insertBefore(chainInfo, eventDescription.nextSibling);
            }
            
            // 显示选项
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('hidden');
            
            gameState.currentEvent.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                
                let optionText = option.text;
                // 如果选项有花费，显示花费金额
                if (option.cost) {
                    optionText += ` <span class="cost">(花费: ${option.cost}元)</span>`;
                }
                
                // 如果选项需要消耗物品，显示需要物品
                if (option.requiresItem) {
                    optionText += ` <span class="cost">(需要: ${option.requiresItem})</span>`;
                }
                
                optionBtn.innerHTML = optionText;
                
                // 检查是否有足够的财富选择这个选项
                if (option.cost && gameState.wealth < option.cost) {
                    optionBtn.disabled = false; // 改为不禁用，允许选择但会有负面效果
                    optionBtn.title = "财富值不足，选择此选项可能导致失败";
                }
                
                // 检查是否有需要的物品
                if (option.requiresItem && !gameState.items.includes(option.requiresItem)) {
                    optionBtn.disabled = true;
                    optionBtn.title = "缺少必要物品: " + option.requiresItem;
                }
                
                optionBtn.addEventListener('click', function() {
                    handleOptionSelect(option);
                });
                
                optionsContainer.appendChild(optionBtn);
            });
        }

        function startEndingEvent() {
            itemsPanel.classList.add('hidden');
            systemPanel.classList.add('hidden');
            endingContainer.classList.add('hidden');
            resultMessage.classList.add('hidden');
            
            eventBtn.classList.add('hidden');
            
            // 显示结局选择
            eventDescription.textContent = "恭喜你完成了15个人生事件！现在，你需要选择自己的人生结局。根据你积累的财富、社会地位和持有的物品，以下结局可供选择：";
            
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('hidden');
            
            // 如果有高利贷债务且借款次数达到3次，优先显示高利贷缠身结局
            if (gameState.items.includes("高利贷债务") && gameState.loanCount >= 3) {
                const endingBtn = document.createElement('button');
                endingBtn.className = 'option-btn failure';
                endingBtn.textContent = "高利贷缠身";
                endingBtn.addEventListener('click', function() {
                    showEnding("failure7");
                });
                optionsContainer.appendChild(endingBtn);
                
                const hint = document.createElement('div');
                hint.className = 'hint';
                hint.textContent = "由于你多次使用高利贷且无法偿还，只能选择高利贷缠身结局。";
                optionsContainer.appendChild(hint);
                
                return;
            }
            
            // 如果有其他负面物品，只能选择负面结局
            if (gameState.hasNegativeItem) {
                const negativeItems = gameState.items.filter(item => itemDefinitions[item] && itemDefinitions[item].negative);
                
                // 检查法律纠纷
                if (negativeItems.includes("法律纠纷")) {
                    const endingBtn = document.createElement('button');
                    endingBtn.className = 'option-btn failure';
                    endingBtn.textContent = "误入歧途";
                    endingBtn.addEventListener('click', function() {
                        showEnding("failure6");
                    });
                    optionsContainer.appendChild(endingBtn);
                }

                // 检查被打经历或被嘲讽经历
                if (negativeItems.includes("被打经历") || negativeItems.includes("被嘲讽经历")) {
                    const endingBtn = document.createElement('button');
                    endingBtn.className = 'option-btn failure';
                    endingBtn.textContent = "颜面尽失";
                    endingBtn.addEventListener('click', function() {
                        showEnding("failure8");
                    });
                    optionsContainer.appendChild(endingBtn);
                }

                // 检查家庭矛盾
                if (negativeItems.includes("家庭矛盾")) {
                    const endingBtn = document.createElement('button');
                    endingBtn.className = 'option-btn failure';
                    endingBtn.textContent = "被骗破产";
                    endingBtn.addEventListener('click', function() {
                        showEnding("failure4");
                    });
                    optionsContainer.appendChild(endingBtn);
                }
                
                // 添加一个提示
                const hint = document.createElement('div');
                hint.className = 'hint';
                hint.textContent = "由于你持有负面物品，只能选择对应的失败结局。";
                optionsContainer.appendChild(hint);
                
                return;
            }
            
            // 否则显示所有符合条件的结局
            let hasAvailableEnding = false;
            
            Object.keys(endings).forEach(endingId => {
                const ending = endings[endingId];
                const requirementsMet = checkEndingRequirements(ending.requirements);
                
                if (requirementsMet) {
                    hasAvailableEnding = true;
                    const endingBtn = document.createElement('button');
                    endingBtn.className = `option-btn ${ending.type}`;
                    endingBtn.textContent = ending.title;
                    endingBtn.addEventListener('click', function() {
                        showEnding(endingId);
                    });
                    optionsContainer.appendChild(endingBtn);
                }
            });
            
            // 如果没有符合条件的结局，显示默认失败结局
            if (!hasAvailableEnding) {
                const endingBtn = document.createElement('button');
                endingBtn.className = 'option-btn failure';
                endingBtn.textContent = "误入歧途";
                endingBtn.addEventListener('click', function() {
                    showEnding("failure6");
                });
                optionsContainer.appendChild(endingBtn);
                
                const hint = document.createElement('div');
                hint.className = 'hint';
                hint.textContent = "由于你没有满足任何结局的条件，只能选择默认失败结局。";
                optionsContainer.appendChild(hint);
            }
        }

        function checkEndingRequirements(requirements) {
            if (!requirements) return true;
            
            if (requirements.wealth && gameState.wealth < requirements.wealth) {
                return false;
            }
            
            if (requirements.prestige && gameState.prestige < requirements.prestige) {
                return false;
            }
            
            if (requirements.items) {
                for (let item of requirements.items) {
                    if (!gameState.items.includes(item)) {
                        return false;
                    }
                }
            }
            
            if (requirements.energy && gameState.energy < requirements.energy) {
                return false;
            }
            
            // 特殊条件检查
            if (requirements.special === "accident") {
                return false; // 意外身亡结局只能通过事件触发
            }
            
            return true;
        }

        function handleOptionSelect(option) {
            // 移除故事链指示器（如果有）
            const chainIndicator = document.querySelector('.story-chain-indicator');
            if (chainIndicator) {
                chainIndicator.remove();
            }
            
            let resultText = option.result || "选择已生效。";
            let hasNegativeEffect = false;
            
            // 处理故事链接受或拒绝
            if (option.chainAccept) {
                gameState.activeStoryChain = option.chainAccept;
                resultText += ` 你开始了${storyChains[option.chainAccept].name}故事链。`;
            } else if (option.chainReject) {
                gameState.rejectedChains.push(option.chainReject);
                if (gameState.activeStoryChain === option.chainReject) {
                    gameState.activeStoryChain = null;
                }
                resultText += ` 你拒绝了${storyChains[option.chainReject].name}故事链。`;
            }
            
            // 检查是否需要消耗物品
            if (option.requiresItem) {
                const itemIndex = gameState.items.indexOf(option.requiresItem);
                if (itemIndex !== -1) {
                    gameState.items.splice(itemIndex, 1);
                    resultText += ` 消耗了${option.requiresItem}。`;
                }
            }
            
            // 处理花费
            if (option.cost) {
                if (gameState.wealth < option.cost) {
                    // 财富不足，根据社会地位处理
                    if (gameState.prestige >= 20) {
                        // 社会地位高，可以向银行借款
                        gameState.loanDebt += option.cost;
                        gameState.loanCount++;
                        resultText = `你的财富不足，但凭借你的社会地位，成功向银行借款${option.cost}元完成了这个选择。`;
                    } else {
                        // 社会地位低，只能借高利贷
                        const actualCost = option.cost * 2;
                        gameState.wealth -= actualCost;
                        gameState.loanCount++;
                        if (!gameState.items.includes("高利贷债务")) {
                            gameState.items.push("高利贷债务");
                        }
                        resultText = `您的地位低于20并财富值不足，所以去申请了高利贷完成了本选择。实际花费了${actualCost}元。`;
                        hasNegativeEffect = true;
                    }
                } else {
                    // 正常扣除花费
                    gameState.wealth -= option.cost;
                    resultText += ` 花费了${option.cost}元。`;
                }
            }
            
            // 处理效果（如果没有负面效果）
            if (!hasNegativeEffect && option.effect) {
                if (option.effect.wealth) {
                    gameState.wealth += option.effect.wealth;
                    if (option.effect.wealth > 0) {
                        resultText += ` 获得了${option.effect.wealth}财富值。`;
                    } else if (option.effect.wealth < 0) {
                        resultText += ` 损失了${-option.effect.wealth}财富值。`;
                    }
                }
                if (option.effect.prestige) {
                    gameState.prestige += option.effect.prestige;
                    if (option.effect.prestige > 0) {
                        resultText += ` 社会地位提升了${option.effect.prestige}点。`;
                    } else if (option.effect.prestige < 0) {
                        resultText += ` 社会地位降低了${-option.effect.prestige}点。`;
                    }
                }
                if (option.effect.energy) {
                    // 限制体力变化幅度在5点以内
                    const energyChange = Math.max(-5, Math.min(5, option.effect.energy));
                    gameState.energy += energyChange;
                    if (energyChange > 0) {
                        resultText += ` 体力恢复了${energyChange}点。`;
                    } else if (energyChange < 0) {
                        resultText += ` 体力消耗了${-energyChange}点。`;
                    }
                }
                if (option.effect.item) {
                    // 如果是家庭矛盾物品，且社会地位>=15，则不获得
                    if (option.effect.item === "家庭矛盾" && gameState.prestige >= 15) {
                        // 不获得该物品
                    } else if (option.effect.item === "家庭矛盾" && gameState.prestige < 15) {
                        // 社会地位低于15，获得家庭矛盾物品
                        if (!gameState.items.includes(option.effect.item)) {
                            gameState.items.push(option.effect.item);
                            resultText += ` 获得了${option.effect.item}。`;
                        }
                    } else {
                        // 其他物品正常获得
                        if (!gameState.items.includes(option.effect.item)) {
                            gameState.items.push(option.effect.item);
                            resultText += ` 获得了${option.effect.item}。`;
                        }
                    }
                }
            }
            
            // 检查是否触发意外身亡结局
            if (option.effect && option.effect.energy && option.effect.energy <= -15) {
                showEnding("failure5");
                return;
            }
            
            // 增加完成事件计数
            gameState.completedEvents++;
            gameState.completedEventIds.push(gameState.currentEvent.id);
            gameState.eventHistory.push({
                eventId: gameState.currentEvent.id,
                option: option.text
            });
            
            // 更新显示
            updateDisplay();
            
            // 隐藏选项
            optionsContainer.classList.add('hidden');
            
            // 确保物品面板也被隐藏
            itemsPanel.classList.add('hidden');
            
            // 显示结果消息
            resultMessage.textContent = resultText;
            resultMessage.classList.remove('hidden');
            
            // 重新初始化可用事件
            initializeAvailableEvents();
            
            // 显示开始事件按钮
            eventBtn.classList.remove('hidden');
            
            // 保存游戏状态
            saveGame();
        }

        function showEndingsScreen() {
            startScreen.classList.remove('active');
            gameScreen.classList.remove('active');
            endingsScreen.classList.add('active');
            updateEndingsDisplay();
        }

        function hideEndingsScreen() {
            endingsScreen.classList.remove('active');
            
            if (gameScreen.classList.contains('active')) {
                gameScreen.classList.add('active');
            } else {
                startScreen.classList.add('active');
            }
        }

        function updateEndingsDisplay() {
            const endingCards = document.querySelectorAll('.ending-card');
            
            let unlockedEndings = JSON.parse(localStorage.getItem('lifeSimulatorEndings') || '[]');
            
            endingCards.forEach(card => {
                const title = card.querySelector('.ending-title').textContent;
                
                if (unlockedEndings.includes(title)) {
                    card.classList.add('unlocked');
                    card.classList.remove('locked');
                } else {
                    card.classList.add('locked');
                    card.classList.remove('unlocked');
                }
            });
        }

        function showEnding(endingId) {
            const ending = endings[endingId];
            if (ending) {
                let unlockedEndings = JSON.parse(localStorage.getItem('lifeSimulatorEndings') || '[]');
                if (!unlockedEndings.includes(ending.title)) {
                    unlockedEndings.push(ending.title);
                    localStorage.setItem('lifeSimulatorEndings', JSON.stringify(unlockedEndings));
                }
            }
            
            optionsContainer.classList.add('hidden');
            itemsPanel.classList.add('hidden');
            systemPanel.classList.add('hidden');
            resultMessage.classList.add('hidden');
            
            endingContainer.classList.remove('hidden');
            
            if (!ending) {
                console.error("结局不存在:", endingId);
                return;
            }
            
            const endingTitle = document.createElement('h2');
            endingTitle.textContent = ending.title;
            endingTitle.className = ending.type;
            
            const endingDesc = document.createElement('div');
            endingDesc.className = `ending-message ${ending.type}`;
            endingDesc.textContent = ending.description;
            
            const endGameBtn = document.createElement('button');
            endGameBtn.textContent = "结束游戏";
            endGameBtn.addEventListener('click', function() {
                endGame();
            });
            
            const endingsBtn = document.createElement('button');
            endingsBtn.textContent = "查看结局图鉴";
            endingsBtn.addEventListener('click', function() {
                endingContainer.classList.add('hidden');
                gameScreen.classList.remove('active');
                showEndingsScreen();
            });

            endingContainer.innerHTML = '';
            endingContainer.appendChild(endingTitle);
            endingContainer.appendChild(endingDesc);
            endingContainer.appendChild(endGameBtn);
            endingContainer.appendChild(endingsBtn);
            
            gameState.currentEndingNode = null;
        }

        function resetGameState() {
            gameState.playerName = "";
            gameState.wealth = 100;
            gameState.prestige = 0;
            gameState.energy = 10;
            gameState.completedEvents = 0;
            gameState.items = [];
            gameState.currentEvent = null;
            gameState.eventHistory = [];
            gameState.availableEvents = [];
            gameState.completedEventIds = [];
            gameState.isEndingPhase = false;
            gameState.endingPath = [];
            gameState.currentEndingNode = null;
            gameState.systemCount = 0;
            gameState.loanDebt = 0;
            gameState.loanCount = 0;
            gameState.hasNegativeItem = false;
            gameState.activeStoryChain = null;
            gameState.rejectedChains = [];
            gameState.storyChainProgress = {};
            
            playerNameInput.value = "";
            startBtn.disabled = true;
            eventBtn.textContent = "人生事件 0/15";
            eventBtn.classList.remove('hidden');
            systemBtn.classList.remove('hidden');
            
            eventDescription.textContent = "欢迎来到模拟人生：逆袭之路！你是一个出身贫寒的年轻人，意外获得了一个神秘系统。通过这个系统，你可以在人生关键节点做出选择，利用智慧、勇气和运气改变自己的命运。你需要完成15个事件来积累财富和社会地位，然后面对最终的人生选择。";
        }

        // 初始化游戏
        updateDisplay();
    </script>
</body>
</html>